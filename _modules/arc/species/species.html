

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>arc.species.species &mdash; ARC 1.1.0 Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> ARC
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../running.html">Running ARC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">ARCâ€™s API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools.html">Standalone tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../media.html">Media</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cite.html">How to cite ARC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../licence.html">Licence</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>arc.species.species</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for arc.species.species</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module for representing stationary points (chemical species and transition states).</span>
<span class="sd">If the species is a transition state (TS), its ``ts_guesses`` attribute will have one or more ``TSGuess`` objects.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isclose</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">rmgpy.molecule.element</span> <span class="k">as</span> <span class="nn">elements</span>
<span class="kn">from</span> <span class="nn">arkane.common</span> <span class="kn">import</span> <span class="n">ArkaneSpecies</span><span class="p">,</span> <span class="n">symbol_by_number</span>
<span class="kn">from</span> <span class="nn">arkane.statmech</span> <span class="kn">import</span> <span class="n">is_linear</span>
<span class="kn">from</span> <span class="nn">rmgpy.exceptions</span> <span class="kn">import</span> <span class="n">AtomTypeError</span><span class="p">,</span> <span class="n">InvalidAdjacencyListError</span>
<span class="kn">from</span> <span class="nn">rmgpy.molecule.molecule</span> <span class="kn">import</span> <span class="n">Atom</span><span class="p">,</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">rmgpy.molecule.resonance</span> <span class="kn">import</span> <span class="n">generate_kekule_structure</span>
<span class="kn">from</span> <span class="nn">rmgpy.reaction</span> <span class="kn">import</span> <span class="n">Reaction</span>
<span class="kn">from</span> <span class="nn">rmgpy.species</span> <span class="kn">import</span> <span class="n">Species</span>
<span class="kn">from</span> <span class="nn">rmgpy.statmech</span> <span class="kn">import</span> <span class="n">NonlinearRotor</span><span class="p">,</span> <span class="n">LinearRotor</span>
<span class="kn">from</span> <span class="nn">rmgpy.transport</span> <span class="kn">import</span> <span class="n">TransportData</span>

<span class="kn">from</span> <span class="nn">arc.common</span> <span class="kn">import</span> <span class="p">(</span><span class="n">almost_equal_coords</span><span class="p">,</span>
                        <span class="n">convert_list_index_0_to_1</span><span class="p">,</span>
                        <span class="n">determine_symmetry</span><span class="p">,</span>
                        <span class="n">dfs</span><span class="p">,</span>
                        <span class="n">get_logger</span><span class="p">,</span>
                        <span class="n">get_single_bond_length</span><span class="p">,</span>
                        <span class="n">generate_resonance_structures</span><span class="p">,</span>
                        <span class="n">is_angle_linear</span><span class="p">,</span>
                        <span class="n">read_yaml_file</span><span class="p">,</span>
                        <span class="n">rmg_mol_from_dict_repr</span><span class="p">,</span>
                        <span class="n">rmg_mol_to_dict_repr</span><span class="p">,</span>
                        <span class="n">timedelta_from_str</span><span class="p">,</span>
                        <span class="n">sort_atoms_in_descending_label_order</span><span class="p">,</span>
                        <span class="p">)</span>
<span class="kn">from</span> <span class="nn">arc.exceptions</span> <span class="kn">import</span> <span class="n">InputError</span><span class="p">,</span> <span class="n">RotorError</span><span class="p">,</span> <span class="n">SpeciesError</span><span class="p">,</span> <span class="n">TSError</span>
<span class="kn">from</span> <span class="nn">arc.imports</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">arc.level</span> <span class="kn">import</span> <span class="n">Level</span>
<span class="kn">from</span> <span class="nn">arc.parser</span> <span class="kn">import</span> <span class="p">(</span><span class="n">parse_1d_scan_energies</span><span class="p">,</span>
                        <span class="n">parse_dipole_moment</span><span class="p">,</span>
                        <span class="n">parse_polarizability</span><span class="p">,</span>
                        <span class="n">parse_xyz_from_file</span><span class="p">,</span>
                        <span class="n">process_conformers_file</span><span class="p">,</span>
                        <span class="p">)</span>
<span class="kn">from</span> <span class="nn">arc.species</span> <span class="kn">import</span> <span class="n">conformers</span>
<span class="kn">from</span> <span class="nn">arc.species.converter</span> <span class="kn">import</span> <span class="p">(</span><span class="n">check_isomorphism</span><span class="p">,</span>
                                   <span class="n">check_xyz_dict</span><span class="p">,</span>
                                   <span class="n">check_zmat_dict</span><span class="p">,</span>
                                   <span class="n">compare_confs</span><span class="p">,</span>
                                   <span class="n">get_xyz_radius</span><span class="p">,</span>
                                   <span class="n">modify_coords</span><span class="p">,</span>
                                   <span class="n">molecules_from_xyz</span><span class="p">,</span>
                                   <span class="n">order_atoms_in_mol_list</span><span class="p">,</span>
                                   <span class="n">remove_dummies</span><span class="p">,</span>
                                   <span class="n">rmg_mol_from_inchi</span><span class="p">,</span>
                                   <span class="n">str_to_xyz</span><span class="p">,</span>
                                   <span class="n">translate_to_center_of_mass</span><span class="p">,</span>
                                   <span class="n">xyz_from_data</span><span class="p">,</span>
                                   <span class="n">xyz_to_str</span><span class="p">,</span>
                                   <span class="p">)</span>
<span class="kn">from</span> <span class="nn">arc.species.vectors</span> <span class="kn">import</span> <span class="n">calculate_angle</span><span class="p">,</span> <span class="n">calculate_distance</span><span class="p">,</span> <span class="n">calculate_dihedral_angle</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>

<span class="n">valid_chars</span><span class="p">,</span> <span class="n">minimum_barrier</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;valid_chars&#39;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;minimum_barrier&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="ARCSpecies"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies">[docs]</a><span class="k">class</span> <span class="nc">ARCSpecies</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for representing stationary points.</span>

<span class="sd">    Structures (rotors_dict is initialized in conformers.find_internal_rotors; pivots/scan/top values are 1-indexed)::</span>

<span class="sd">            rotors_dict: {0: {&#39;pivots&#39;: ``List[int]``,  # 1-indexed</span>
<span class="sd">                              &#39;top&#39;: ``List[int]``,  # 1-indexed</span>
<span class="sd">                              &#39;scan&#39;: ``List[int]``,  # 1-indexed</span>
<span class="sd">                              &#39;torsion&#39;: ``List[int]``,  # 0-indexed</span>
<span class="sd">                              &#39;number_of_running_jobs&#39;: ``int``,</span>
<span class="sd">                              &#39;success&#39;: Optional[``bool``],  # ``None`` by default</span>
<span class="sd">                              &#39;invalidation_reason&#39;: ``str``,</span>
<span class="sd">                              &#39;times_dihedral_set&#39;: ``int``,</span>
<span class="sd">                              &#39;scan_path&#39;: &lt;path to scan output file&gt;,</span>
<span class="sd">                              &#39;max_e&#39;: ``float``,  # relative to the minimum energy, in kJ/mol,</span>
<span class="sd">                              &#39;trsh_counter&#39;: ``int``,</span>
<span class="sd">                              &#39;trsh_methods&#39;: ``List[str]``,</span>
<span class="sd">                              &#39;symmetry&#39;: ``int``,</span>
<span class="sd">                              &#39;dimensions&#39;: ``int``,</span>
<span class="sd">                              &#39;original_dihedrals&#39;: ``list``,</span>
<span class="sd">                              &#39;cont_indices&#39;: ``list``,</span>
<span class="sd">                              &#39;directed_scan_type&#39;: ``str``,</span>
<span class="sd">                              &#39;directed_scan&#39;: ``dict``,  # keys: tuples of dihedrals as strings,</span>
<span class="sd">                                                          # values: dicts of energy, xyz, is_isomorphic, trsh</span>
<span class="sd">                             }</span>
<span class="sd">                          1: {}, ...</span>
<span class="sd">                         }</span>

<span class="sd">    Args:</span>
<span class="sd">        label (str, optional): The species label.</span>
<span class="sd">        is_ts (bool, optional): Whether the species represents a transition state.</span>
<span class="sd">        rmg_species (Species, optional): An RMG Species object to be converted to an ARCSpecies object.</span>
<span class="sd">        mol (Molecule, optional): An ``RMG Molecule``. Atom order corresponds to the order in .initial_xyz</span>
<span class="sd">        xyz (list, str, dict, optional): Entries are either string-format coordinates, file paths, or ARC&#39;s dict format.</span>
<span class="sd">                                         (If there&#39;s only one entry, it could be given directly, not in a list).</span>
<span class="sd">                                         The file paths could direct to either a .xyz file, ARC conformers</span>
<span class="sd">                                         (w/ or w/o energies), or an ESS log/input files.</span>
<span class="sd">        multiplicity (int, optional): The species&#39; electron spin multiplicity. Can be determined from the</span>
<span class="sd">                                      adjlist/smiles/xyz (If unspecified, assumed to be either a singlet or a doublet).</span>
<span class="sd">        charge (int, optional): The species&#39; net charge. Assumed to be 0 if unspecified.</span>
<span class="sd">        smiles (str, optional): A `SMILES &lt;https://en.wikipedia.org/wiki/Simplified_molecular-input_line-entry_system&gt;`_</span>
<span class="sd">                                representation for the species 2D graph.</span>
<span class="sd">        adjlist (str, optional): An `RMG adjacency list</span>
<span class="sd">                                 &lt;https://reactionmechanismgenerator.github.io/RMG-Py/reference/molecule/adjlist.html&gt;`_</span>
<span class="sd">                                 representation for the species 2D graph.</span>
<span class="sd">        inchi (str, optional): An `InChI &lt;https://www.inchi-trust.org/&gt;`_ representation for the species 2D graph.</span>
<span class="sd">        bond_corrections (dict, optional): The bond additivity corrections (BAC) to be used. Determined from the</span>
<span class="sd">                                           structure if not directly given.</span>
<span class="sd">        compute_thermo (bool, optional): Whether to calculate thermodynamic properties for this species.</span>
<span class="sd">        include_in_thermo_lib (bool, optional): Whether to include in the output RMG library.</span>
<span class="sd">        e0_only (bool, optional): Whether to only run statmech (w/o thermo) to compute E0.</span>
<span class="sd">        species_dict (dict, optional): A dictionary to create this object from (used when restarting ARC).</span>
<span class="sd">        yml_path (str, optional): Path to an Arkane YAML file representing a species (for loading the object).</span>
<span class="sd">        ts_number (int, optional): An auto-generated number associating the TS ARCSpecies object with the corresponding</span>
<span class="sd">                                   :ref:`ARCReaction &lt;reaction&gt;` object.</span>
<span class="sd">        rxn_label (str, optional): The reaction string (relevant for TSs).</span>
<span class="sd">        rxn_index (int, optional): The reaction index which is the respective key to the Scheduler rxn_dict.</span>
<span class="sd">        external_symmetry (int, optional): The external symmetry of the species (not including rotor symmetries).</span>
<span class="sd">        optical_isomers (int, optional): Whether (=2) or not (=1) the species has chiral center/s.</span>
<span class="sd">        run_time (timedelta, optional): Overall species execution time.</span>
<span class="sd">        checkfile (str, optional): The local path to the latest checkfile by Gaussian for the species.</span>
<span class="sd">        number_of_radicals (int, optional): The number of radicals (inputted by the user, ARC won&#39;t attempt to determine</span>
<span class="sd">                                            it). Defaults to None. Important, e.g., if a Species is a bi-rad singlet,</span>
<span class="sd">                                            in which case the job should be unrestricted, but the multiplicity does not</span>
<span class="sd">                                            have the required information to make that decision (r vs. u).</span>
<span class="sd">        force_field (str, optional): The force field to be used for conformer screening. The default is MMFF94s.</span>
<span class="sd">                                     Other optional force fields are MMFF94, UFF, or GAFF (not recommended, slow).</span>
<span class="sd">                                     If &#39;fit&#39; is specified for this parameter, some initial MMFF94s conformers will be</span>
<span class="sd">                                     generated, then force field parameters will be fitted for this molecule and</span>
<span class="sd">                                     conformers will be re-run with the fitted force field (recommended for drug-like</span>
<span class="sd">                                     species and species with many heteroatoms). Another option is specifying &#39;cheap&#39;,</span>
<span class="sd">                                     and the &quot;old&quot; RDKit embedding method will be used.</span>
<span class="sd">        bdes (list, optional): Specifying for which bonds should bond dissociation energies be calculated.</span>
<span class="sd">                               Entries are bonded atom indices tuples (1-indexed). An &#39;all_h&#39; string entry is also</span>
<span class="sd">                               allowed, triggering BDE calculations for all hydrogen atoms in the molecule.</span>
<span class="sd">        directed_rotors (dict): Execute a directed internal rotation scan (i.e., a series of sp or constrained opt jobs)</span>
<span class="sd">                                for the pivots of interest. The optional primary keys are:</span>
<span class="sd">                                - &#39;brute_force_sp&#39;</span>
<span class="sd">                                - &#39;brute_force_opt&#39;</span>
<span class="sd">                                - &#39;cont_opt&#39;</span>
<span class="sd">                                - &#39;ess&#39;</span>
<span class="sd">                                The brute force methods will generate all the geometries in advance and submit all</span>
<span class="sd">                                relevant jobs simultaneously. The continuous method will wait for the previous job</span>
<span class="sd">                                to terminate, and use its geometry as the initial guess for the next job.</span>
<span class="sd">                                Another set of three keys is allowed, adding `_diagonal` to each of the above</span>
<span class="sd">                                keys. the secondary keys are therefore:</span>
<span class="sd">                                - &#39;brute_force_sp_diagonal&#39;</span>
<span class="sd">                                - &#39;brute_force_opt_diagonal&#39;</span>
<span class="sd">                                - &#39;cont_opt_diagonal&#39;</span>
<span class="sd">                                Specifying &#39;_diagonal&#39; will increment all the respective dihedrals together,</span>
<span class="sd">                                resulting in a 1D scan instead of an ND scan.</span>
<span class="sd">                                Values are nested lists. Each value is a list where the entries are either pivot lists</span>
<span class="sd">                                (e.g., [1, 5]) or lists of pivot lists (e.g., [[1, 5], [6, 8]]), or a mix</span>
<span class="sd">                                (e.g., [[4, 8], [[6, 9], [3, 4]]]). The requested directed scan type will be executed</span>
<span class="sd">                                separately for each list entry in the value. A list entry that contains only two pivots</span>
<span class="sd">                                will result in a 1D scan, while a list entry with N pivots will consider all of them,</span>
<span class="sd">                                and will result in an ND scan if &#39;_diagonal&#39; is not specified.</span>
<span class="sd">                                ARC will generate geometries using the ``rotor_scan_resolution`` argument in settings.py</span>
<span class="sd">                                Note: An &#39;all&#39; string entry is also allowed in the value list, triggering a directed</span>
<span class="sd">                                internal rotation scan for all torsions in the molecule. If &#39;all&#39; is specified within</span>
<span class="sd">                                a second level list, then all the dihedrals will be considered together.</span>
<span class="sd">                                Currently, ARC does not automatically identify torsions to be treated as ND, and this</span>
<span class="sd">                                attribute must be specified by the user.</span>
<span class="sd">                                An additional supported key is &#39;ess&#39;, in which case ARC will allow the ESS to take care</span>
<span class="sd">                                of spawning the ND continuous constrained optimizations (not yet implemented).</span>
<span class="sd">        consider_all_diastereomers (bool, optional): Whether to consider all different chiralities (tetrahedral carbon</span>
<span class="sd">                                                     centers, nitrogen inversions, and cis/trans double bonds) when</span>
<span class="sd">                                                     generating conformers. ``True`` to consider all. If no 3D</span>
<span class="sd">                                                     coordinates are given for the species, all diastereomers will be</span>
<span class="sd">                                                     considered, otherwise the chirality specified by the given</span>
<span class="sd">                                                     coordinates will be preserved.</span>
<span class="sd">        preserve_param_in_scan (list, optional): Entries are length two iterables of atom indices (1-indexed)</span>
<span class="sd">                                                 between which distances and dihedrals of these pivots must be</span>
<span class="sd">                                                 preserved. Used for identification of rotors which break a TS.</span>
<span class="sd">        fragments (Optional[List[List[int]]]):</span>
<span class="sd">            Fragments represented by this species, i.e., as in a VdW well or a TS.</span>
<span class="sd">            Entries are atom index lists of all atoms in a fragment, each list represents a different fragment.</span>
<span class="sd">        occ (int, optional): The number of occupied orbitals (core + val) from a molpro CCSD sp calc.</span>
<span class="sd">        irc_label (str, optional): The label of an original ``ARCSpecies`` object (a TS) for which an IRC job was spawned.</span>
<span class="sd">                                   The present species object instance represents a geometry optimization job of the IRC</span>
<span class="sd">                                   result in one direction.</span>
<span class="sd">        project_directory (str, optional): The path to the project directory.</span>
<span class="sd">        multi_species: (str, optional): The multi-species set this species belongs to. Used for running a set of species</span>
<span class="sd">                                       simultaneously in a single ESS input file. A species marked as multi_species</span>
<span class="sd">                                       will only have one conformer considered (n_confs set to 1).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        label (str): The species&#39; label.</span>
<span class="sd">        original_label (str): The species&#39; label prior to modifications (removing forbidden characters).</span>
<span class="sd">        multiplicity (int): The species&#39; electron spin multiplicity. Can be determined from the adjlist/smiles/xyz</span>
<span class="sd">                            (If unspecified, assumed to be either a singlet or a doublet).</span>
<span class="sd">        charge (int): The species&#39; net charge. Assumed to be 0 if unspecified.</span>
<span class="sd">        number_of_radicals (int): The number of radicals (inputted by the user, ARC won&#39;t attempt to determine it).</span>
<span class="sd">                                  Defaults to None. Important, e.g., if a Species is a bi-rad singlet, in which case</span>
<span class="sd">                                  the job should be unrestricted, but the multiplicity does not have the required</span>
<span class="sd">                                  information to make that decision (r vs. u).</span>
<span class="sd">        e_elect (float): The total electronic energy (without ZPE) at the chosen sp level, in kJ/mol.</span>
<span class="sd">        e0 (float): The 0 Kelvin energy (total electronic energy plus ZPE) at the chosen sp level, in kJ/mol.</span>
<span class="sd">        is_ts (bool):  Whether the species represents a transition state. `True` if it does.</span>
<span class="sd">        number_of_rotors (int): The number of potential rotors to scan.</span>
<span class="sd">        rotors_dict (dict): A dictionary of rotors. structure given below.</span>
<span class="sd">        conformers (list): A list of selected conformers XYZs (dict format).</span>
<span class="sd">        conformer_energies (list): A list of conformers E0 (in kJ/mol).</span>
<span class="sd">        cheap_conformer (str): A string format xyz of a cheap conformer (not necessarily the best/lowest one).</span>
<span class="sd">        most_stable_conformer (int): The index of the best/lowest conformer in self.conformers.</span>
<span class="sd">        recent_md_conformer (list): A length three list containing the coordinates of the recent conformer</span>
<span class="sd">                                    generated by MD, the energy in kJ/mol, and the number of MD runs. Used to detect</span>
<span class="sd">                                    when the MD algorithm converges on a single structure.</span>
<span class="sd">        initial_xyz (dict): The initial geometry guess.</span>
<span class="sd">        final_xyz (dict): The optimized species geometry.</span>
<span class="sd">        _radius (float): The species radius in Angstrom.</span>
<span class="sd">        opt_level (str): Level of theory for geometry optimization. Saved for archiving.</span>
<span class="sd">        _number_of_atoms (int): The number of atoms in the species/TS.</span>
<span class="sd">        mol (Molecule): An ``RMG Molecule`` object used for BAC determination.</span>
<span class="sd">                        Atom order corresponds to the order in .initial_xyz</span>
<span class="sd">        mol_list (list): A list of localized structures generated from &#39;mol&#39;, if possible.</span>
<span class="sd">        rmg_species (Species): An RMG Species object to be converted to an ARCSpecies object.</span>
<span class="sd">        bond_corrections (dict): The bond additivity corrections (BAC) to be used. Determined from the structure</span>
<span class="sd">                                 if not directly given.</span>
<span class="sd">        run_time (timedelta): Overall species execution time.</span>
<span class="sd">        t1 (float): The T1 diagnostic parameter from Molpro.</span>
<span class="sd">        neg_freqs_trshed (list): A list of negative frequencies this species was troubleshooted for.</span>
<span class="sd">        compute_thermo (bool): Whether to calculate thermodynamic properties for this species.</span>
<span class="sd">        include_in_thermo_lib (bool): Whether to include in the output RMG library.</span>
<span class="sd">        e0_only (bool): Whether to only run statmech (w/o thermo) to compute E0.</span>
<span class="sd">        thermo (HeatCapacityModel): The thermodata calculated by ARC.</span>
<span class="sd">        rmg_thermo (HeatCapacityModel): The thermodata generated by RMG for comparison.</span>
<span class="sd">        long_thermo_description (str): A description for the species entry in the thermo library outputted.</span>
<span class="sd">        ts_guesses (list): A list of TSGuess objects for each of the specified methods.</span>
<span class="sd">        successful_methods (list): Methods used to generate a TS guess that successfully generated an XYZ guess.</span>
<span class="sd">        unsuccessful_methods (list): Methods used to generate a TS guess that were unsuccessfully.</span>
<span class="sd">        chosen_ts (int): The TSGuess index corresponding to the chosen TS conformer used for optimization.</span>
<span class="sd">        chosen_ts_list (List[int]): The TSGuess index corresponding to the TS guesses that were tried out.</span>
<span class="sd">        chosen_ts_method (str): The TS method that was actually used for optimization.</span>
<span class="sd">        ts_checks (Dict[str, bool]): Checks that a TS species went through.</span>
<span class="sd">        rxn_zone_atom_indices (List[int]): 0-indexed atom indices of the active reaction zone.</span>
<span class="sd">        ts_conf_spawned (bool): Whether conformers were already spawned for the Species (representing a TS) based on its</span>
<span class="sd">                                TSGuess objects.</span>
<span class="sd">        tsg_spawned (bool): If this species is a TS, this attribute describes whether TS guess jobs were already spawned.</span>
<span class="sd">        ts_guesses_exhausted (bool): Whether all TS guesses were tried out with no luck</span>
<span class="sd">                                     (``True`` if no convergence achieved).</span>
<span class="sd">        ts_number (int): An auto-generated number associating the TS ARCSpecies object with the corresponding</span>
<span class="sd">                         :ref:`ARCReaction &lt;reaction&gt;` object.</span>
<span class="sd">        ts_report (str): A description of all methods used for guessing a TS and their ranking.</span>
<span class="sd">        rxn_label (str): The reaction string (relevant for TSs).</span>
<span class="sd">        rxn_index (int): The reaction index which is the respective key to the Scheduler rxn_dict.</span>
<span class="sd">        arkane_file (str): Path to the Arkane Species file generated in processor.</span>
<span class="sd">        yml_path (str): Path to an Arkane YAML file representing a species (for loading the object).</span>
<span class="sd">        keep_mol (bool): Label to prevent the generation of a new Molecule object.</span>
<span class="sd">        checkfile (str): The local path to the latest checkfile by Gaussian for the species.</span>
<span class="sd">        external_symmetry (int): The external symmetry of the species (not including rotor symmetries).</span>
<span class="sd">        optical_isomers (int): Whether (=2) or not (=1) the species has chiral center/s.</span>
<span class="sd">        transport_data (TransportData): A placeholder for updating transport properties after Lennard-Jones</span>
<span class="sd">                                        calculation (using OneDMin).</span>
<span class="sd">        force_field (str): The force field to be used for conformer screening. The default is MMFF94s.</span>
<span class="sd">                           Other optional force fields are MMFF94, UFF, or GAFF (not recommended, slow).</span>
<span class="sd">                           If &#39;fit&#39; is specified for this parameter, some initial MMFF94s conformers will be generated,</span>
<span class="sd">                           then force field parameters will be fitted for this molecule and conformers will be re-run</span>
<span class="sd">                           with the fitted force field (recommended for drug-like species and species with many</span>
<span class="sd">                           heteroatoms). Another option is specifying &#39;cheap&#39;, and the &quot;old&quot; RDKit embedding method</span>
<span class="sd">                           will be used.</span>
<span class="sd">        conf_is_isomorphic (bool): Whether the lowest conformer is isomorphic with the 2D graph representation</span>
<span class="sd">                                   of the species. ``True`` if it is. Defaults to ``None``. If ``True``, an isomorphism</span>
<span class="sd">                                   check will be strictly enforced for the final optimized coordinates.</span>
<span class="sd">        conformers_before_opt (tuple): Conformers XYZs of a species before optimization.</span>
<span class="sd">        bdes (list): Specifying for which bonds should bond dissociation energies be calculated.</span>
<span class="sd">                     Entries are bonded atom indices tuples (1-indexed). An &#39;all_h&#39; string entry is also allowed,</span>
<span class="sd">                     triggering BDE calculations for all hydrogen atoms in the molecule.</span>
<span class="sd">        directed_rotors (dict): Execute a directed internal rotation scan (i.e., a series of constrained optimizations).</span>
<span class="sd">                                Data is in 3 levels of nested lists, converted from pivots to four-atom torsion indices.</span>
<span class="sd">        consider_all_diastereomers (bool, optional): Whether to consider all different chiralities (tetrahydral carbon</span>
<span class="sd">                                                     centers, nitrogen inversions, and cis/trans double bonds) when</span>
<span class="sd">                                                     generating conformers. ``True`` to consider all.</span>
<span class="sd">        zmat (dict): The species internal coordinates (Z Matrix).</span>
<span class="sd">        preserve_param_in_scan (list): Entries are length two iterables of atom indices (1-indexed) between which</span>
<span class="sd">                                       distances and dihedrals of these pivots must be preserved.</span>
<span class="sd">        fragments (Optional[List[List[int]]]):</span>
<span class="sd">            Fragments represented by this species, i.e., as in a VdW well or a TS.</span>
<span class="sd">            Entries are atom index lists of all atoms in a fragment, each list represents a different fragment.</span>
<span class="sd">        occ (int): The number of occupied orbitals (core + val) from a molpro CCSD sp calc.</span>
<span class="sd">        irc_label (str): The label of an original ``ARCSpecies`` object (a TS)  for which an IRC job was spawned.</span>
<span class="sd">                         The present species object instance represents a geometry optimization job of the IRC</span>
<span class="sd">                         result in one direction. If a species is a transition state, then this attribute contains the</span>
<span class="sd">                         labels of the two corresponding &quot;IRC species&quot;, separated by a blank space.</span>
<span class="sd">        project_directory (str): The path to the project directory.</span>
<span class="sd">        multi_species: (str): The multi-species set this species belongs to. Used for running a set of species</span>
<span class="sd">                             simultaneously in a single ESS input file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">adjlist</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">bdes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">bond_corrections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">charge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">checkfile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">compute_thermo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_in_thermo_lib</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">consider_all_diastereomers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">directed_rotors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">e0_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">external_symmetry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">fragments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">force_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MMFF94s&#39;</span><span class="p">,</span>
                 <span class="n">inchi</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">is_ts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">irc_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">mol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Molecule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">multiplicity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">multi_species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">number_of_radicals</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">occ</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">optical_isomers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">preserve_param_in_scan</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rmg_species</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Species</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">run_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rxn_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rxn_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">species_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">ts_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">xyz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">yml_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">keep_mol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">project_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts_number</span> <span class="o">=</span> <span class="n">ts_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conformers_before_opt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">most_stable_conformer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recent_md_conformer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conformer_energies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thermo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmg_thermo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmg_kinetics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_atoms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_heavy_atoms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjlist</span> <span class="o">=</span> <span class="n">adjlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_species</span> <span class="o">=</span> <span class="n">multi_species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_radicals</span> <span class="o">=</span> <span class="n">number_of_radicals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="o">=</span> <span class="n">external_symmetry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irc_label</span> <span class="o">=</span> <span class="n">irc_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ</span> <span class="o">=</span> <span class="n">occ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="o">=</span> <span class="n">optical_isomers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span> <span class="o">=</span> <span class="n">run_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkfile</span> <span class="o">=</span> <span class="n">checkfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport_data</span> <span class="o">=</span> <span class="n">TransportData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="o">=</span> <span class="n">yml_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_mol</span> <span class="o">=</span> <span class="n">keep_mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fragments</span> <span class="o">=</span> <span class="n">fragments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxn_zone_atom_indices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts_checks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="o">=</span> <span class="n">project_directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

        <span class="k">if</span> <span class="n">species_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Reading from a dictionary (it&#39;s possible that the dict contains only a &#39;yml_path&#39; argument, check first)</span>
            <span class="k">if</span> <span class="s1">&#39;yml_path&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;yml_path&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">species_dict</span><span class="o">=</span><span class="n">species_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">species_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Not reading from a dictionary.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force_field</span> <span class="o">=</span> <span class="n">force_field</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span> <span class="o">=</span> <span class="n">is_ts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_conf_spawned</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses_exhausted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e_elect</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arkane_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conf_is_isomorphic</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="o">=</span> <span class="n">bdes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span> <span class="o">=</span> <span class="n">directed_rotors</span> <span class="k">if</span> <span class="n">directed_rotors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consider_all_diastereomers</span> <span class="o">=</span> <span class="n">consider_all_diastereomers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zmat</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span> <span class="o">=</span> <span class="n">preserve_param_in_scan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rxn_label</span> <span class="o">=</span> <span class="n">rxn_label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rxn_index</span> <span class="o">=</span> <span class="n">rxn_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">successful_methods</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unsuccessful_methods</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_method</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_thermo</span> <span class="o">=</span> <span class="n">compute_thermo</span> <span class="k">if</span> <span class="n">compute_thermo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">include_in_thermo_lib</span> <span class="o">=</span> <span class="n">include_in_thermo_lib</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e0_only</span> <span class="o">=</span> <span class="n">e0_only</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">long_thermo_description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_level</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="ow">or</span> <span class="n">yml_path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span> <span class="o">=</span> <span class="n">rmg_species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tsg_spawned</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">regen_mol</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">bond_corrections</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="o">=</span> <span class="n">bond_corrections</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># a YAML path was given</span>
                <span class="n">regen_mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_yml_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">regen_mol</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">adjlist</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_adjacency_list</span><span class="p">(</span><span class="n">adjlist</span><span class="o">=</span><span class="n">adjlist</span><span class="p">,</span>
                                                                  <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                  <span class="n">raise_charge_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                  <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">inchi</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">rmg_mol_from_inchi</span><span class="p">(</span><span class="n">inchi</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">smiles</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="n">smiles</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_mol_list</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># an RMG Species was given</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="p">,</span> <span class="n">Species</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The rmg_species parameter has to be a valid RMG Species object. &#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;Got: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="o">.</span><span class="n">molecule</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="s1">&#39;If an RMG Species given, it must have a non-empty molecule list&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="s1">&#39;If an RMG Species given, it must have a label or a label must be given &#39;</span>
                                       <span class="s1">&#39;separately&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="o">.</span><span class="n">label</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">multiplicity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_species</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_net_charge</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">process_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">multiplicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span>
            <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">adjlist</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_adjacency_list</span><span class="p">(</span><span class="n">adjlist</span><span class="o">=</span><span class="n">adjlist</span><span class="p">,</span>
                                                              <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                              <span class="n">raise_charge_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                              <span class="p">)</span>
                <span class="k">elif</span> <span class="n">inchi</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">rmg_mol_from_inchi</span><span class="p">(</span><span class="n">inchi</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">smiles</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="n">smiles</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_net_charge</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">regen_mol</span><span class="p">:</span>
                <span class="c1"># Perceive molecule from xyz coordinates. This also populates the .mol attribute of the Species.</span>
                <span class="c1"># It overrides self.mol generated from adjlist or smiles so xyz and mol will have the same atom order.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_stable_conformer</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol_from_xyz</span><span class="p">(</span><span class="n">get_cheap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
                <span class="c1"># We don&#39;t care about BACs in TSs</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_thermo</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No structure (SMILES, adjList, RMG Species, or RMG Molecule) was given for &#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">, NOT using bond additivity corrections (BAC) for thermo &#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;computation.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Generate bond list for applying bond additivity corrections</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="o">=</span> <span class="n">enumerate_bonds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">long_thermo_description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Bond corrections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_thermo</span> \
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot determine bond additivity corrections (BAC) for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> based on &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;xyz coordinates only. For better thermodynamic properties, provide bond corrections.&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">neg_freqs_trshed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determine_multiplicity</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Multiplicity for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> is not an integer. &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;Got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Multiplicity for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> is lower than 1. Got: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Charge for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> is not an integer. &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;Got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No structure (xyz, SMILES, adjList, RMG Species or Molecule) &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;was given for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;preserve_param_in_scan must be a list, got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span><span class="si">}</span><span class="s1">, &#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Each entry in preserve_param_in_scan must be a length 2 list, got &#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;preserve_param_in_scan must be 1-indexed, got:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_label</span> <span class="o">=</span> <span class="n">check_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">is_ts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">)</span>
        <span class="n">allowed_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;brute_force_sp&#39;</span><span class="p">,</span> <span class="s1">&#39;brute_force_opt&#39;</span><span class="p">,</span> <span class="s1">&#39;cont_opt&#39;</span><span class="p">,</span> <span class="s1">&#39;ess&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;brute_force_sp_diagonal&#39;</span><span class="p">,</span> <span class="s1">&#39;brute_force_opt_diagonal&#39;</span><span class="p">,</span> <span class="s1">&#39;cont_opt_diagonal&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Allowed keys for directed_rotors are </span><span class="si">{</span><span class="n">allowed_keys</span><span class="si">}</span><span class="s1">. Got </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The .bdes argument (of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">) must be a list, &#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">bde</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">bde</span> <span class="o">==</span> <span class="s1">&#39;all_h&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bde</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
                                               <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">b</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bde</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Something is wrong with the .bdes attribute of </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">. &#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;Expected tuples of two 1-indexed atoms, got:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_mol_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_checks</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;warnings&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_ts_checks</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string representation of the object&quot;&quot;&quot;</span>
        <span class="n">str_representation</span> <span class="o">=</span> <span class="s1">&#39;ARCSpecies(&#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;label=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;smiles=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;is_ts=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="si">}</span><span class="s1">, &#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;multiplicity=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="si">}</span><span class="s1">, &#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;charge=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">return</span> <span class="n">str_representation</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">number_of_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of atoms in the species&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_atoms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_atoms</span>

    <span class="nd">@number_of_atoms</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow setting number of atoms, e.g. a TS might not have Molecule or xyz when initialized&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_atoms</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">number_of_heavy_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The number of heavy (non hydrogen) atoms in the species&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_heavy_atoms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_heavy_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">atom</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_non_hydrogen</span><span class="p">()])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_heavy_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">symbol</span> <span class="o">!=</span> <span class="s1">&#39;H&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ts_guess</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ts_guess</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_heavy_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">ts_guess</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">symbol</span> <span class="o">!=</span> <span class="s1">&#39;H&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_heavy_atoms</span>

    <span class="nd">@number_of_heavy_atoms</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_of_heavy_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow setting number of heavy atoms, e.g. a TS might not have Molecule or xyz when initialized&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_number_of_heavy_atoms</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the largest distance from the coordinate system origin attributed to one of the molecule&#39;s</span>
<span class="sd">        atoms in 3D space.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The radius in Angstrom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">get_xyz_radius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Determined a radius of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_radius</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> Angstrom for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span>

    <span class="nd">@radius</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow setting the radius&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ARCSpecies.copy"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a copy of this object instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ARCSpecies: A copy of this object instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">species_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(</span><span class="n">reset_atom_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ARCSpecies</span><span class="p">(</span><span class="n">species_dict</span><span class="o">=</span><span class="n">species_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.as_dict"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">reset_atom_ids</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function for dumping this object as a dictionary in a YAML file for restarting ARC.</span>

<span class="sd">        Args:</span>
<span class="sd">            reset_atom_ids (bool, optional): Whether to reset the atom IDs in the .mol Molecule attribute.</span>
<span class="sd">                                             Useful when copying the object to avoid duplicate atom IDs between</span>
<span class="sd">                                             different object instances.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The dictionary representation of the object instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">species_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;force_field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_field</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;is_ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t1</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;long_thermo_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_thermo_description</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;multiplicity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_species</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;multi_species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_species</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;compute_thermo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_thermo</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_in_thermo_lib</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;include_in_thermo_lib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_in_thermo_lib</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;number_of_rotors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;external_symmetry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjlist</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;adjlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjlist</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">irc_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;irc_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">irc_label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;optical_isomers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neg_freqs_trshed</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;neg_freqs_trshed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neg_freqs_trshed</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> \
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neg_freqs_trshed</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">neg_freqs_trshed</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;arkane_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arkane_file</span>
        <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;consider_all_diastereomers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consider_all_diastereomers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_guesses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tsg</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">tsg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">]</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_conf_spawned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_conf_spawned</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_guesses_exhausted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses_exhausted</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_number</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxn_label</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxn_index</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;successful_methods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successful_methods</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;unsuccessful_methods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsuccessful_methods</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;chosen_ts_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_method</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;chosen_ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn_zone_atom_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxn_zone_atom_indices</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;chosen_ts_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_list</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_checks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_checks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;original_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_elect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;e_elect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_elect</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;fragments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragments</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0_only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;e0_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0_only</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsg_spawned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;tsg_spawned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsg_spawned</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;yml_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;run_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_radicals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;number_of_radicals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_radicals</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;opt_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_level</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;directed_rotors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_is_isomorphic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conf_is_isomorphic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_is_isomorphic</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;bond_corrections&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmg_mol_to_dict_repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">reset_atom_ids</span><span class="o">=</span><span class="n">reset_atom_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;initial_xyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;final_xyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;zmat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmat</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;checkfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkfile</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;occ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_stable_conformer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;most_stable_conformer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_stable_conformer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;cheap_conformer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_md_conformer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;recent_md_conformer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recent_md_conformer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conformers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz_to_str</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">]</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conformer_energies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformer_energies</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers_before_opt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conformers_before_opt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz_to_str</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers_before_opt</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;bdes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;preserve_param_in_scan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">rotors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">rotor_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rotor_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;directed_scan&#39;</span><span class="p">:</span>
                        <span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">dihedrals</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">result_val</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">result_key</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                                    <span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">][</span><span class="n">result_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result_val</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">result_key</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
                                    <span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">][</span><span class="n">result_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="n">result_val</span><span class="p">)</span> \
                                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_val</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">][</span><span class="n">result_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_val</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rotors_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotors_dict</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># this marks the species to skip rotor scans (it is not an empty dict)</span>
            <span class="c1"># this is valuable information, store it in the restart file</span>
            <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rotors_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span>
        <span class="k">return</span> <span class="n">species_dict</span></div>

<div class="viewcode-block" id="ARCSpecies.from_dict"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function for loading this object from a dictionary in a YAML file for restarting ARC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;All species must have a label&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;run_time&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;run_time&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_label</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;original_label&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;original_label&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t1</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;t1&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_elect</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;e_elect&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;e_elect&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;e0&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;e0&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsg_spawned</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;tsg_spawned&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;tsg_spawned&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;occ&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;occ&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arkane_file</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;arkane_file&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;arkane_file&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;yml_path&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;yml_path&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxn_label</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn_label&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;rxn_label&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxn_index</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn_index&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;rxn_index&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">most_stable_conformer</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;most_stable_conformer&#39;</span><span class="p">]</span> \
            <span class="k">if</span> <span class="s1">&#39;most_stable_conformer&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="o">=</span> <span class="n">check_xyz_dict</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;cheap_conformer&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;cheap_conformer&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recent_md_conformer</span> <span class="o">=</span> <span class="n">str_to_xyz</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;recent_md_conformer&#39;</span><span class="p">])</span> \
            <span class="k">if</span> <span class="s1">&#39;recent_md_conformer&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fragments</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;fragments&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fragments&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_field</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;force_field&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;force_field&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="s1">&#39;MMFF94s&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_thermo_description</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;long_thermo_description&#39;</span><span class="p">]</span> \
            <span class="k">if</span> <span class="s1">&#39;long_thermo_description&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="o">=</span> <span class="n">str_to_xyz</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;initial_xyz&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;initial_xyz&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="o">=</span> <span class="n">str_to_xyz</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;final_xyz&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;final_xyz&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_is_isomorphic</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conf_is_isomorphic&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;conf_is_isomorphic&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zmat</span> <span class="o">=</span> <span class="n">check_zmat_dict</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;zmat&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;zmat&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;is_ts&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;is_ts&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts_conf_spawned</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_conf_spawned&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;ts_conf_spawned&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> \
            <span class="k">else</span> <span class="kc">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjlist</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;adjlist&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;adjlist&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_number</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_number&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;ts_number&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses_exhausted</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_guesses_exhausted&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;ts_guesses_exhausted&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_report&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;ts_report&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span> <span class="o">=</span> <span class="p">[</span><span class="n">TSGuess</span><span class="p">(</span><span class="n">ts_dict</span><span class="o">=</span><span class="n">tsg</span><span class="p">)</span> <span class="k">for</span> <span class="n">tsg</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_guesses&#39;</span><span class="p">]]</span> \
                <span class="k">if</span> <span class="s1">&#39;ts_guesses&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">successful_methods</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;successful_methods&#39;</span><span class="p">]</span> \
                <span class="k">if</span> <span class="s1">&#39;successful_methods&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unsuccessful_methods</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;unsuccessful_methods&#39;</span><span class="p">]</span> \
                <span class="k">if</span> <span class="s1">&#39;unsuccessful_methods&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_method</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;chosen_ts_method&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;chosen_ts_method&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;chosen_ts&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;chosen_ts&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rxn_zone_atom_indices</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn_zone_atom_indices&#39;</span><span class="p">]</span> \
                <span class="k">if</span> <span class="s1">&#39;rxn_zone_atom_indices&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_checks</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;ts_checks&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;ts_checks&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_list</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;chosen_ts_list&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;chosen_ts_list&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkfile</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;checkfile&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;checkfile&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;xyz&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_xyz</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;multiplicity&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;multiplicity&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_species</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;multi_species&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;multi_species&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;charge&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_thermo</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;compute_thermo&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;compute_thermo&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_in_thermo_lib</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;include_in_thermo_lib&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;include_in_thermo_lib&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e0_only</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;e0_only&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;e0_only&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_radicals</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;number_of_radicals&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;number_of_radicals&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_level</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;opt_level&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;opt_level&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;number_of_rotors&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;number_of_rotors&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;external_symmetry&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;external_symmetry&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irc_label</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;irc_label&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;irc_label&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;optical_isomers&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;optical_isomers&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neg_freqs_trshed</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;neg_freqs_trshed&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;neg_freqs_trshed&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;bond_corrections&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;bond_corrections&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;mol&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_adjacency_list</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">],</span>
                                                              <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                              <span class="n">raise_charge_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">AtomTypeError</span><span class="p">,</span> <span class="n">InvalidAdjacencyListError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read RMG adjacency list </span><span class="si">{</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Got:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">rmg_mol_from_dict_repr</span><span class="p">(</span><span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">],</span> <span class="n">is_ts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">smiles</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;smiles&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">inchi</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;inchi&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;inchi&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">adjlist</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;adjlist&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;adjlist&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">adjlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_adjacency_list</span><span class="p">(</span><span class="n">adjlist</span><span class="o">=</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                          <span class="n">raise_charge_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">inchi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">rmg_mol_from_inchi</span><span class="p">(</span><span class="n">inchi</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Got a list value type for SMILES of species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">smiles</span><span class="si">}</span><span class="s1">, type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;Did you mean to enter this as a string? Consider adding quotation marks &#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;before and after the SMILES value if entering through a YAML file.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="n">smiles</span><span class="p">)</span>
        <span class="c1"># Perceive molecule from xyz coordinates. This also populates the .mol attribute of the Species.</span>
        <span class="c1"># It overrides self.mol generated from adjlist or smiles so xyz and mol will have the same atom order.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_stable_conformer</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol_from_xyz</span><span class="p">(</span><span class="n">get_cheap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;bond_corrections&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span> <span class="o">=</span> <span class="n">enumerate_bonds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">long_thermo_description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Bond corrections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_corrections</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_net_charge</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;conformers&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span> <span class="o">=</span> <span class="p">[</span><span class="n">str_to_xyz</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conformers&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conformer_energies</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conformer_energies&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;conformer_energies&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> \
                <span class="k">else</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conformers_before_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">str_to_xyz</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;conformers_before_opt&#39;</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="s1">&#39;conformers_before_opt&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
            <span class="c1"># Only TS species are allowed to be loaded w/o a structure</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Must have either mol or xyz for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;directed_rotors&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;directed_rotors&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consider_all_diastereomers</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;consider_all_diastereomers&#39;</span><span class="p">]</span> \
            <span class="k">if</span> <span class="s1">&#39;consider_all_diastereomers&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;bdes&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;bdes&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The .bdes argument must be a list, got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;rotors_dict&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="ow">and</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rotors_dict&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preserve_param_in_scan</span> <span class="o">=</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;preserve_param_in_scan&#39;</span><span class="p">]</span> \
            <span class="k">if</span> <span class="s1">&#39;preserve_param_in_scan&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;rotors_dict&#39;</span> <span class="ow">in</span> <span class="n">species_dict</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">rotor_dict</span> <span class="ow">in</span> <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rotors_dict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rotor_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;directed_scan&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">dihedrals</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">directed_scan_key</span><span class="p">,</span> <span class="n">directed_scan_val</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">directed_scan_key</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">][</span><span class="n">directed_scan_key</span><span class="p">]</span> <span class="o">=</span> \
                                        <span class="nb">float</span><span class="p">(</span><span class="n">directed_scan_val</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">directed_scan_key</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">][</span><span class="n">directed_scan_key</span><span class="p">]</span> <span class="o">=</span> \
                                        <span class="n">str_to_xyz</span><span class="p">(</span><span class="n">directed_scan_val</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">dihedrals</span><span class="p">][</span><span class="n">directed_scan_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">directed_scan_val</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="ARCSpecies.from_yml_file"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.from_yml_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_yml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load important species attributes such as label and final_xyz from an Arkane YAML file.</span>
<span class="sd">        Actual QM data parsing is done later when processing thermo and kinetics.</span>

<span class="sd">        Args:</span>
<span class="sd">            label (str, optional): The specie label.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the adjlist cannot be read.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether self.mol should be regenerated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">regen_mol</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">rmg_spc</span> <span class="o">=</span> <span class="n">Species</span><span class="p">()</span>
        <span class="n">arkane_spc</span> <span class="o">=</span> <span class="n">ArkaneSpecies</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">rmg_spc</span><span class="p">)</span>
        <span class="c1"># The data from the YAML file is loaded into the `species` argument of the `load_yaml` method in Arkane</span>
        <span class="n">yml_content</span> <span class="o">=</span> <span class="n">read_yaml_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span><span class="p">)</span>
        <span class="n">arkane_spc</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yml_path</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">pdep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="o">=</span> <span class="n">xyz_from_data</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">arkane_spc</span><span class="o">.</span><span class="n">conformer</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                       <span class="n">numbers</span><span class="o">=</span><span class="n">arkane_spc</span><span class="o">.</span><span class="n">conformer</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mol&#39;</span> <span class="ow">in</span> <span class="n">yml_content</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">rmg_mol_from_dict_repr</span><span class="p">(</span><span class="n">representation</span><span class="o">=</span><span class="n">yml_content</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">],</span> <span class="n">is_ts</span><span class="o">=</span><span class="n">yml_content</span><span class="p">[</span><span class="s1">&#39;is_ts&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">regen_mol</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">regen_mol</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">adjacency_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_adjacency_list</span><span class="p">(</span><span class="n">adjlist</span><span class="o">=</span><span class="n">arkane_spc</span><span class="o">.</span><span class="n">adjacency_list</span><span class="p">,</span>
                                                              <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not read adjlist:</span><span class="se">\n</span><span class="si">{</span><span class="n">arkane_spc</span><span class="o">.</span><span class="n">adjacency_list</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># should *not* be logging</span>
                    <span class="k">raise</span>
            <span class="k">elif</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">inchi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_inchi</span><span class="p">(</span><span class="n">inchistr</span><span class="o">=</span><span class="n">arkane_spc</span><span class="o">.</span><span class="n">inchi</span><span class="p">,</span> <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_smiles</span><span class="p">(</span><span class="n">arkane_spc</span><span class="o">.</span><span class="n">smiles</span><span class="p">,</span> <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">get_net_charge</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">conformer</span><span class="o">.</span><span class="n">spin_multiplicity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="o">=</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">conformer</span><span class="o">.</span><span class="n">optical_isomers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">external_symmetry_mode</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">conformer</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="p">(</span><span class="n">NonlinearRotor</span><span class="p">,</span> <span class="n">LinearRotor</span><span class="p">)):</span>
                    <span class="n">external_symmetry_mode</span> <span class="o">=</span> <span class="n">mode</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">external_symmetry_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="o">=</span> <span class="n">external_symmetry_mode</span><span class="o">.</span><span class="n">symmetry</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol_from_xyz</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">=</span> <span class="n">arkane_spc</span><span class="o">.</span><span class="n">conformer</span><span class="o">.</span><span class="n">E0</span><span class="o">.</span><span class="n">value_si</span> <span class="o">*</span> <span class="mf">0.001</span>  <span class="c1"># convert to kJ/mol</span>
        <span class="k">return</span> <span class="n">regen_mol</span></div>

<div class="viewcode-block" id="ARCSpecies.set_mol_list"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.set_mol_list">[docs]</a>    <span class="k">def</span> <span class="nf">set_mol_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the .mol_list attribute from self.mol by generating resonance structures, preserving atom order.</span>
<span class="sd">        The mol_list attribute is used for identifying rotors and generating conformers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">assign_atom_ids</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
                <span class="n">mol_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">mol_copy</span><span class="o">.</span><span class="n">reactive</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="o">=</span> <span class="n">generate_resonance_structures</span><span class="p">(</span><span class="n">mol_copy</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">]</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">order_atoms_in_mol_list</span><span class="p">(</span><span class="n">ref_mol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">mol_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ARCSpecies.is_monoatomic"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.is_monoatomic">[docs]</a>    <span class="k">def</span> <span class="nf">is_monoatomic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine whether the species is monoatomic.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[bool]: Whether the species is monoatomic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ARCSpecies.is_diatomic"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.is_diatomic">[docs]</a>    <span class="k">def</span> <span class="nf">is_diatomic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine whether the species is diatomic.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[bool]: Whether the species is diatomic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ARCSpecies.is_isomorphic"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.is_isomorphic">[docs]</a>    <span class="k">def</span> <span class="nf">is_isomorphic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;ARCSpecies&#39;</span><span class="p">,</span> <span class="n">Species</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine whether the species is isomorphic with ``other``.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Union[ARCSpecies, Species, Molecule]): An ARCSpecies, RMG Species, or RMG Molecule object instance</span>
<span class="sd">                                                          to compare isomorphism with.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[bool]: Whether the species is isomorphic with ``other``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ARCSpecies</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">mol</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">mol_</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mol_</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">is_isomorphic</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">is_isomorphic</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Species</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">other_mol</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">molecule</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">mol_</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">mol_</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">is_isomorphic</span><span class="p">(</span><span class="n">other_mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
                            <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">is_isomorphic</span><span class="p">(</span><span class="n">other_mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Can only compare isomorphism to other ARCSpecies, RMG Species, or RMG Molecule &#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;object instances, got </span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s1"> which is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.generate_conformers"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.generate_conformers">[docs]</a>    <span class="k">def</span> <span class="nf">generate_conformers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">n_confs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                            <span class="n">e_confs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="n">plot_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate conformers.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_confs (int, optional): The max number of conformers to store in the .conformers attribute</span>
<span class="sd">                                     that will later be DFT&#39;ed at the conformers_level.</span>
<span class="sd">            e_confs (float, optional): The energy threshold in kJ/mol above the lowest energy conformer below which all</span>
<span class="sd">                                       (unique) generated conformers will be stored in the .conformers attribute.</span>
<span class="sd">            plot_path (str, optional): A folder path in which the plot will be saved.</span>
<span class="sd">                                       If None, the plot will not be shown (nor saved).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_mol_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">:</span>
            <span class="n">mol_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consider_all_diastereomers</span><span class="p">:</span>
            <span class="n">diastereomers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">generate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">diastereomers</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">lowest_confs</span> <span class="o">=</span> <span class="n">conformers</span><span class="o">.</span><span class="n">generate_conformers</span><span class="p">(</span><span class="n">mol_list</span><span class="o">=</span><span class="n">mol_list</span><span class="p">,</span>
                                                      <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                                                      <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                                                      <span class="n">multiplicity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span>
                                                      <span class="n">force_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">force_field</span><span class="p">,</span>
                                                      <span class="n">print_logs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                      <span class="n">n_confs</span><span class="o">=</span><span class="n">n_confs</span><span class="p">,</span>
                                                      <span class="n">e_confs</span><span class="o">=</span><span class="n">e_confs</span><span class="p">,</span>
                                                      <span class="n">return_all_conformers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                      <span class="n">plot_path</span><span class="o">=</span><span class="n">plot_path</span><span class="p">,</span>
                                                      <span class="n">diastereomers</span><span class="o">=</span><span class="n">diastereomers</span><span class="p">,</span>
                                                      <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lowest_confs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">lowest_confs</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conformer_energies</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">lowest_confs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">generate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">xyz</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No 3D coordinates available for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.get_cheap_conformer"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.get_cheap_conformer">[docs]</a>    <span class="k">def</span> <span class="nf">get_cheap_conformer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cheaply (limiting the number of possible conformers) get a reasonable conformer,</span>
<span class="sd">        this could very well not be the best (lowest energy) one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_monoatomic</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="o">=</span> \
                <span class="n">conformers</span><span class="o">.</span><span class="n">generate_monoatomic_conformer</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">)[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_diatomic</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="o">=</span> \
                <span class="n">conformers</span><span class="o">.</span><span class="n">generate_diatomic_conformer</span><span class="p">(</span><span class="n">symbol_1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                                                       <span class="n">symbol_2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                                                       <span class="n">multiplicity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">)[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_confs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">rd_mol</span> <span class="o">=</span> <span class="n">conformers</span><span class="o">.</span><span class="n">embed_rdkit</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">mol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">num_confs</span><span class="o">=</span><span class="n">num_confs</span><span class="p">)</span>
            <span class="n">xyzs</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="n">conformers</span><span class="o">.</span><span class="n">rdkit_force_field</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                                                          <span class="n">rd_mol</span><span class="o">=</span><span class="n">rd_mol</span><span class="p">,</span>
                                                          <span class="n">mol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span>
                                                          <span class="n">num_confs</span><span class="o">=</span><span class="n">num_confs</span><span class="p">,</span>
                                                          <span class="n">force_field</span><span class="o">=</span><span class="s1">&#39;MMFF94s&#39;</span><span class="p">,</span>
                                                          <span class="p">)</span>
            <span class="k">if</span> <span class="n">energies</span><span class="p">:</span>
                <span class="n">min_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
                <span class="n">min_energy_index</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_energy</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="o">=</span> <span class="n">xyzs</span><span class="p">[</span><span class="n">min_energy_index</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">xyzs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="o">=</span> <span class="n">xyzs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not generate a cheap conformer for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ARCSpecies.get_xyz"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.get_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">get_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">generate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">return_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the highest quality xyz the species has.</span>
<span class="sd">        If it doesn&#39;t have any 3D information, and if ``generate`` is ``True``, cheaply generate it.</span>
<span class="sd">        Returns ``None`` if no xyz can be retrieved nor generated.</span>

<span class="sd">        Args:</span>
<span class="sd">            generate (bool, optional): Whether to cheaply generate an FF conformer if no xyz is found.</span>
<span class="sd">                                       ``True`` to generate. If generate is ``False`` and the species has no xyz data,</span>
<span class="sd">                                       the method will return None.</span>
<span class="sd">            return_format (str, optional): Whether to output a &#39;dict&#39; or a &#39;str&#39; representation of the respective xyz.</span>

<span class="sd">        Return:</span>
<span class="sd">             Optional[Union[dict, str]]: The xyz coordinates in the requested representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_stable_conformer</span> <span class="ow">or</span> <span class="n">conf</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ts_guess</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ts_guess</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xyz</span> <span class="o">=</span> <span class="n">ts_guess</span><span class="o">.</span><span class="n">opt_xyz</span> <span class="ow">or</span> <span class="n">ts_guess</span><span class="o">.</span><span class="n">initial_xyz</span>
                        <span class="k">return</span> <span class="n">xyz</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">generate</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cheap_conformer</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheap_conformer</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">generate_conformers</span><span class="p">(</span><span class="n">n_confs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">return_format</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyz</span></div>

<div class="viewcode-block" id="ARCSpecies.determine_rotors"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.determine_rotors">[docs]</a>    <span class="k">def</span> <span class="nf">determine_rotors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine possible unique rotors in the species to be treated as hindered rotors,</span>
<span class="sd">        taking into account all localized structures.</span>
<span class="sd">        The resulting rotors are saved in a ``{&#39;pivots&#39;: [1, 3], &#39;top&#39;: [3, 7], &#39;scan&#39;: [2, 1, 3, 7]}`` format</span>
<span class="sd">        in ``self.rotors_dict``. Also updates ``self.number_of_rotors``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="c1"># This species was marked to skip rotor scans (when ``rotors_dict`` is ``None``), or a rotors dictionary already exist.</span>
            <span class="k">return</span>
        <span class="n">mol_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_list</span> <span class="ow">or</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mol_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">([</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mol_list</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not determine rotors for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> without a 2D graph structure&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mol_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">rotors</span> <span class="o">=</span> <span class="n">conformers</span><span class="o">.</span><span class="n">find_internal_rotors</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">new_rotor</span> <span class="ow">in</span> <span class="n">rotors</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">existing_rotor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">existing_rotor</span><span class="p">[</span><span class="s1">&#39;pivots&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_rotor</span><span class="p">[</span><span class="s1">&#39;pivots&#39;</span><span class="p">]:</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_rotor</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Found one possible rotor for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Found </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span><span class="si">}</span><span class="s1"> possible rotors for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pivot list(s) for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">: &#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;pivots&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span><span class="p">)]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_directed_rotors</span><span class="p">()</span></div>

<div class="viewcode-block" id="ARCSpecies.initialize_directed_rotors"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.initialize_directed_rotors">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_directed_rotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize self.directed_rotors, correcting the input to nested lists and to torsions instead of pivots.</span>
<span class="sd">        Also modifies self.rotors_dict to remove respective 1D rotors dicts if appropriate and adds ND rotors dicts.</span>
<span class="sd">        Principally, from this point we don&#39;t really need self.directed_rotors, self.rotors_dict should have all</span>
<span class="sd">        relevant rotors info for the species, including directed and ND rotors.</span>

<span class="sd">        Raises:</span>
<span class="sd">            SpeciesError: If the pivots don&#39;t represent a dihedral in the species.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span><span class="p">:</span>
            <span class="n">all_pivots</span> <span class="o">=</span> <span class="p">[</span><span class="n">rotor_dict</span><span class="p">[</span><span class="s1">&#39;pivots&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rotor_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
            <span class="n">directed_rotors</span><span class="p">,</span> <span class="n">directed_rotors_scans</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Reformat as nested lists.</span>
                <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">val1</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">val1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]]:</span>
                        <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;directed_scan pivots must be lists of length 2, got </span><span class="si">{</span><span class="n">val1</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">corrected_val</span> <span class="o">=</span> <span class="n">val1</span> <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_pivots</span> <span class="k">else</span> <span class="p">[</span><span class="n">val1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># re-order if needed</span>
                        <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">corrected_val</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                        <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">val2</span> <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_pivots</span> <span class="k">else</span> <span class="p">[</span><span class="n">val2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val2</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                                                     <span class="k">for</span> <span class="n">val2</span> <span class="ow">in</span> <span class="n">val1</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">val1</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                        <span class="c1"># 1st level all, add all pivots, they will be treated separately</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;pivots&#39;</span><span class="p">]]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                                <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;pivots&#39;</span><span class="p">]])</span>
                    <span class="k">elif</span> <span class="n">val1</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
                        <span class="c1"># 2nd level all, add all pivots, they will be treated together</span>
                        <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_pivots</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;directed_scan pivots must be lists of length 2, got </span><span class="si">{</span><span class="n">val1</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">corrected_val</span> <span class="o">=</span> <span class="n">val1</span> <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_pivots</span> <span class="k">else</span> <span class="p">[</span><span class="n">val1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">corrected_val</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                        <span class="n">directed_rotors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">val2</span> <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_pivots</span> <span class="k">else</span> <span class="p">[</span><span class="n">val2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">val2</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                                                     <span class="k">for</span> <span class="n">val2</span> <span class="ow">in</span> <span class="n">val1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals1</span> <span class="ow">in</span> <span class="n">directed_rotors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># check</span>
                <span class="k">for</span> <span class="n">vals2</span> <span class="ow">in</span> <span class="n">vals1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_pivots</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The pivots </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1"> do not represent a rotor in species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">. &#39;</span>
                                               <span class="sa">f</span><span class="s1">&#39;Valid rotor pivots are: </span><span class="si">{</span><span class="n">all_pivots</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                                               <span class="sa">f</span><span class="s1">&#39;Species coordinates:</span><span class="se">\n</span><span class="si">{</span><span class="n">xyz_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># Modify self.rotors_dict to remove respective 1D rotors dicts and add ND rotors dicts.</span>
            <span class="n">rotor_indices_to_del</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">directed_rotors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># An independent loop, so 1D *directed* scans won&#39;t be deleted (treated above).</span>
                <span class="k">for</span> <span class="n">pivots_list</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="n">new_rotor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pivots&#39;</span><span class="p">:</span> <span class="n">pivots_list</span><span class="p">,</span>  <span class="c1"># 1-indexed</span>
                                 <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>  <span class="c1"># 1-indexed</span>
                                 <span class="s1">&#39;scan&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>  <span class="c1"># 1-indexed</span>
                                 <span class="s1">&#39;torsion&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>  <span class="c1"># 0-indexed</span>
                                 <span class="s1">&#39;number_of_running_jobs&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;invalidation_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;times_dihedral_set&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="s1">&#39;trsh_counter&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="s1">&#39;trsh_methods&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
                                 <span class="s1">&#39;scan_path&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;directed_scan_type&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
                                 <span class="s1">&#39;directed_scan&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(),</span>
                                 <span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="s1">&#39;original_dihedrals&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
                                 <span class="s1">&#39;cont_indices&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
                                 <span class="p">}</span>
                    <span class="k">for</span> <span class="n">pivots</span> <span class="ow">in</span> <span class="n">pivots_list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">rotor_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">rotor_dict</span><span class="p">[</span><span class="s1">&#39;pivots&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pivots</span><span class="p">:</span>
                                <span class="n">new_rotor</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotor_dict</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">])</span>
                                <span class="n">new_rotor</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotor_dict</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">])</span>
                                <span class="n">new_rotor</span><span class="p">[</span><span class="s1">&#39;torsion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotor_dict</span><span class="p">[</span><span class="s1">&#39;torsion&#39;</span><span class="p">])</span>
                                <span class="n">new_rotor</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="n">rotor_dict</span><span class="p">[</span><span class="s1">&#39;directed_scan_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ess&#39;</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rotor_indices_to_del</span><span class="p">:</span>
                                    <span class="c1"># Remove this rotor dict, an ND one will be created instead.</span>
                                    <span class="n">rotor_indices_to_del</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                                <span class="k">break</span>
                    <span class="k">if</span> <span class="n">new_rotor</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">pass</span>  <span class="c1"># Todo: consolidate top</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_rotor</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">rotor_indices_to_del</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Renumber the keys so iterative looping will make sense.</span>
            <span class="n">new_rotors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rotor_dict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())):</span>
                <span class="n">new_rotors_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotor_dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="o">=</span> <span class="n">new_rotors_dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_rotors</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Replace pivots with four-atom scans.</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">directed_rotors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">directed_rotors_scans</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">pivots_list</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">rotors_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">rotors_dict</span><span class="p">[</span><span class="s1">&#39;pivots&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pivots_list</span><span class="p">:</span>
                            <span class="n">directed_rotors_scans</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotors_dict</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">])</span>
                            <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directed_rotors</span> <span class="o">=</span> <span class="n">directed_rotors_scans</span></div>

<div class="viewcode-block" id="ARCSpecies.set_dihedral"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.set_dihedral">[docs]</a>    <span class="k">def</span> <span class="nf">set_dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">scan</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                     <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">deg_increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">deg_abs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">count</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">xyz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">chk_rotor_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the dihedral angle value of the torsion ``scan``.</span>
<span class="sd">        Either increment by a given value or set to an absolute value.</span>
<span class="sd">        All bonded atoms are rotated as groups. The result is saved to ``self.initial_xyz``.</span>

<span class="sd">        Args:</span>
<span class="sd">            scan (list): The atom indices representing the dihedral.</span>
<span class="sd">            index (int, optional): Whether the atom indices are 1-indexed (pass ``1``) or 0-indexed (pass ``0``).</span>
<span class="sd">            deg_increment (float, optional): The dihedral angle increment in degrees.</span>
<span class="sd">            deg_abs (float, optional): The absolute desired dihedral angle in degrees.</span>
<span class="sd">            count (bool, optional): Whether to increment the rotor&#39;s times_dihedral_set parameter. `True` to increment.</span>
<span class="sd">            xyz (dict, optional): An alternative xyz to use instead of self.final_xyz.</span>
<span class="sd">            chk_rotor_list (bool, optional): Whether to check if the changing dihedral is in the rotor list.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InputError: If both ``deg_increment`` and ``deg_abs`` are None.</span>
<span class="sd">            RotorError: If the rotor could not be identified based on the pivots.</span>
<span class="sd">            TypeError: If ``deg_increment`` or ``deg_abs`` are of wrong type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">deg_increment</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deg_abs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Either deg_increment or deg_abs must be specified.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deg_increment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deg_increment</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deg_increment must be a float, got </span><span class="si">{</span><span class="n">deg_increment</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">deg_increment</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deg_abs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deg_abs</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deg_abs must be a float, got </span><span class="si">{</span><span class="n">deg_abs</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">deg_abs</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">pivots</span> <span class="o">=</span> <span class="n">scan</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">torsion</span> <span class="o">=</span> <span class="n">convert_list_index_0_to_1</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">direction</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">index</span> <span class="k">else</span> <span class="n">scan</span>
        <span class="n">rotor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set dihedral without xyz&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deg_increment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deg_abs</span> <span class="o">=</span> <span class="n">calculate_dihedral_angle</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span> <span class="n">torsion</span><span class="o">=</span><span class="n">torsion</span><span class="p">)</span> <span class="o">+</span> <span class="n">deg_increment</span>
        <span class="k">if</span> <span class="n">is_angle_linear</span><span class="p">(</span><span class="n">calculate_angle</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">torsion</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> \
                <span class="ow">or</span> <span class="n">is_angle_linear</span><span class="p">(</span><span class="n">calculate_angle</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot change a dihedral that contains a linear segment. Got torsion:</span><span class="si">{</span><span class="n">torsion</span><span class="si">}</span><span class="s1">, xyz:</span><span class="se">\n</span><span class="si">{</span><span class="n">xyz</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
        <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="n">molecules_from_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">mols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">chk_rotor_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rotor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;pivots&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pivots</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">rotor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RotorError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not identify rotor based of pivots </span><span class="si">{</span><span class="n">pivots</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">count</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;times_dihedral_set&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rotor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rotor </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> with pivots </span><span class="si">{</span><span class="n">rotor</span><span class="p">[</span><span class="s2">&quot;pivots&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> was set &#39;</span>
                                     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rotor</span><span class="p">[</span><span class="s2">&quot;times_dihedral_set&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> times&#39;</span><span class="p">)</span>
                    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;invalidation_reason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;rotor set too many (</span><span class="si">{</span><span class="n">rotor</span><span class="p">[</span><span class="s2">&quot;times_dihedral_set&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">) times&#39;</span>
                    <span class="k">return</span>
                <span class="n">rotor</span><span class="p">[</span><span class="s1">&#39;times_dihedral_set&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">deg_increment</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">deg_abs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;set_dihedral was called with zero increment for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> with pivots </span><span class="si">{</span><span class="n">pivots</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_xyz</span> <span class="o">=</span> <span class="n">modify_coords</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span>
                                    <span class="n">indices</span><span class="o">=</span><span class="n">torsion</span><span class="p">,</span>
                                    <span class="n">new_value</span><span class="o">=</span><span class="n">deg_abs</span><span class="p">,</span>
                                    <span class="n">modification_type</span><span class="o">=</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span>
                                    <span class="n">mol</span><span class="o">=</span><span class="n">mol</span><span class="p">,</span>
                                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="o">=</span> <span class="n">new_xyz</span></div>

<div class="viewcode-block" id="ARCSpecies.determine_symmetry"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.determine_symmetry">[docs]</a>    <span class="k">def</span> <span class="nf">determine_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the external symmetry and chirality (optical isomers) of the species.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()</span>
        <span class="n">symmetry</span><span class="p">,</span> <span class="n">optical_isomers</span> <span class="o">=</span> <span class="n">determine_symmetry</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="ow">or</span> <span class="n">optical_isomers</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span> <span class="o">!=</span> <span class="n">optical_isomers</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User input of optical isomers for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2"> and ARC&#39;s calculation differ: &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">optical_isomers</span><span class="si">}</span><span class="s2">, respectively. &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;Using the user input of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_isomers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="ow">or</span> <span class="n">symmetry</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span> <span class="o">!=</span> <span class="n">symmetry</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User input of external symmetry for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2"> and ARC&#39;s calculation differ: &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">symmetry</span><span class="si">}</span><span class="s2">, respectively. &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;Using the user input of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">external_symmetry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.determine_multiplicity"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.determine_multiplicity">[docs]</a>    <span class="k">def</span> <span class="nf">determine_multiplicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">adjlist</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">mol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Molecule</span><span class="p">],</span>
                               <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the spin multiplicity of the species.</span>

<span class="sd">        Args:</span>
<span class="sd">            smiles (str): The SMILES descriptor .</span>
<span class="sd">            adjlist (str): The adjacency list descriptor.</span>
<span class="sd">            mol (Molecule): The respective RMG Molecule object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determine_multiplicity_from_descriptors</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="n">smiles</span><span class="p">,</span> <span class="n">adjlist</span><span class="o">=</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">mol</span><span class="o">=</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determine_multiplicity_from_xyz</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not determine multiplicity for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.determine_multiplicity_from_descriptors"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.determine_multiplicity_from_descriptors">[docs]</a>    <span class="k">def</span> <span class="nf">determine_multiplicity_from_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                <span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                <span class="n">adjlist</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                <span class="n">mol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Molecule</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the spin multiplicity of the species from the chemical descriptors.</span>

<span class="sd">        Args:</span>
<span class="sd">            smiles (str): The SMILES descriptor .</span>
<span class="sd">            adjlist (str): The adjacency list descriptor.</span>
<span class="sd">            mol (Molecule): The respective RMG Molecule object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span>
        <span class="k">elif</span> <span class="n">adjlist</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">from_adjacency_list</span><span class="p">(</span><span class="n">adjlist</span><span class="p">,</span>
                                                 <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                 <span class="n">raise_charge_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                 <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span>
        <span class="k">elif</span> <span class="n">smiles</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="n">smiles</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span></div>

<div class="viewcode-block" id="ARCSpecies.determine_multiplicity_from_xyz"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.determine_multiplicity_from_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">determine_multiplicity_from_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the spin multiplicity of the species from the xyz.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">):</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xyz</span><span class="p">:</span>
            <span class="n">electrons</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">symbol_by_number</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="n">symb</span><span class="p">:</span>
                        <span class="n">electrons</span> <span class="o">+=</span> <span class="n">number</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not identify atom symbol </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">electrons</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span>
            <span class="k">if</span> <span class="n">electrons</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Multiplicity not specified for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">, assuming a value of 2&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Multiplicity not specified for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">, assuming a value of 1&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.make_ts_report"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.make_ts_report">[docs]</a>    <span class="k">def</span> <span class="nf">make_ts_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A helper function to write content into the .ts_report attribute&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">TS method summary for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxn_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rxn_label</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">successful_methods</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="s1">&#39;Methods that successfully generated a TS guess:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">successful_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">successful_methods</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="n">successful_method</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsuccessful_methods</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Methods that were unsuccessfully in generating a TS guess:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">unsuccessful_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsuccessful_methods</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="n">unsuccessful_method</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses_exhausted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ts_report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The method that generated the best TS guess and its output used for the &#39;</span> \
                                  <span class="sa">f</span><span class="s1">&#39;optimization: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen_ts_method</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="ARCSpecies.cluster_tsgs"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.cluster_tsgs">[docs]</a>    <span class="k">def</span> <span class="nf">cluster_tsgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cluster TSGuesses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">cluster_tsgs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tsg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cluster_tsg</span> <span class="ow">in</span> <span class="n">cluster_tsgs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cluster_tsg</span><span class="o">.</span><span class="n">almost_equal_tsgs</span><span class="p">(</span><span class="n">tsg</span><span class="p">):</span>
                    <span class="n">cluster_tsg</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsg</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tsg</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cluster_tsg</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
                        <span class="n">cluster_tsg</span><span class="o">.</span><span class="n">method</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; + </span><span class="si">{</span><span class="n">tsg</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="n">cluster_tsg</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cluster_tsg</span><span class="o">.</span><span class="n">execution_time</span><span class="si">}</span><span class="s1"> + </span><span class="si">{</span><span class="n">tsg</span><span class="o">.</span><span class="n">execution_time</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tsg</span><span class="o">.</span><span class="n">cluster</span> <span class="o">=</span> <span class="p">[</span><span class="n">tsg</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">cluster_tsgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span> <span class="o">=</span> <span class="n">cluster_tsgs</span></div>

<div class="viewcode-block" id="ARCSpecies.process_completed_tsg_queue_jobs"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.process_completed_tsg_queue_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">process_completed_tsg_queue_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yml_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process YAML files which are the output of running a TS guess job in the queue.</span>

<span class="sd">        Args:</span>
<span class="sd">            yml_path (str): The path to the output YAML file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yml_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">yml_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">tsg_list</span> <span class="o">=</span> <span class="n">read_yaml_file</span><span class="p">(</span><span class="n">yml_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tsg_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tsg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">tsg</span> <span class="ow">in</span> <span class="n">tsg_list</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">tsgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">TSGuess</span><span class="p">(</span><span class="n">ts_dict</span><span class="o">=</span><span class="n">tsg_dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">tsg_dict</span> <span class="ow">in</span> <span class="n">tsg_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tsg</span> <span class="ow">in</span> <span class="n">tsgs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tsg</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">colliding_atoms</span><span class="p">(</span><span class="n">tsg</span><span class="o">.</span><span class="n">initial_xyz</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">tsg</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tsg</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_tsgs</span><span class="p">()</span></div>

<div class="viewcode-block" id="ARCSpecies.mol_from_xyz"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.mol_from_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">mol_from_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">xyz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">get_cheap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure atom order in self.mol corresponds to xyz.</span>
<span class="sd">        Important for TS searches and for identifying rotor indices.</span>
<span class="sd">        This works by generating a molecule from xyz and using the</span>
<span class="sd">        2D structure to confirm that the perceived molecule is correct.</span>
<span class="sd">        If ``xyz`` is not given, the species xyz attribute will be used.</span>

<span class="sd">        Args:</span>
<span class="sd">            xyz (dict, optional): Alternative coordinates to use.</span>
<span class="sd">            get_cheap (bool, optional): Whether to generate conformers if the species has no xyz data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">generate</span><span class="o">=</span><span class="n">get_cheap</span><span class="p">,</span> <span class="n">return_format</span><span class="o">=</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> \
                <span class="ow">and</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Hard-coded for triplet O2 and S2: Don&#39;t perceive mol.</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The number of atoms in the molecule and in the coordinates of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> is different.&#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Got:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_adjacency_list</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">and:</span><span class="se">\n</span><span class="si">{</span><span class="n">xyz</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># self.mol should have come from another source, e.g., SMILES or yml.</span>
            <span class="n">mol_s</span><span class="p">,</span> <span class="n">mol_b</span> <span class="o">=</span> <span class="n">molecules_from_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span>
                                              <span class="n">multiplicity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span>
                                              <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
            <span class="n">perceived_mol</span> <span class="o">=</span> <span class="n">mol_b</span> <span class="ow">or</span> <span class="n">mol_s</span>
            <span class="k">if</span> <span class="n">perceived_mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">allow_nonisomorphic_2d</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span> \
                                         <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">has_charge</span><span class="p">()</span> <span class="ow">or</span> <span class="n">perceived_mol</span><span class="o">.</span><span class="n">has_charge</span><span class="p">()</span> \
                                         <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> \
                                         <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">perceived_mol</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">&gt;=</span> <span class="mi">3</span>
                <span class="n">isomorphic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_xyz_isomorphism</span><span class="p">(</span><span class="n">mol</span><span class="o">=</span><span class="n">perceived_mol</span><span class="p">,</span>
                                                        <span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span>
                                                        <span class="n">allow_nonisomorphic_2d</span><span class="o">=</span><span class="n">allow_nonisomorphic_2d</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isomorphic</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;XYZ and the 2D graph representation for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> are not isomorphic.</span><span class="se">\n</span><span class="s1">Got &#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;xyz:</span><span class="se">\n</span><span class="si">{</span><span class="n">xyz</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">which corresponds to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_adjacency_list</span><span class="p">()</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">and: &#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_adjacency_list</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;XYZ and the 2D graph representation for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> are not compliant.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_mol</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">perceived_mol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol_s</span><span class="p">,</span> <span class="n">mol_b</span> <span class="o">=</span> <span class="n">molecules_from_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mol_b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_b</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">mol_b</span>
            <span class="k">elif</span> <span class="n">mol_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_s</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">mol_s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not infer a 2D graph for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.process_xyz"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.process_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">process_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process the user&#39;s input and add either to the .conformers attribute or to .ts_guesses.</span>

<span class="sd">        Args:</span>
<span class="sd">            xyz_list (list, str, dict): Entries are either string-format, dict-format coordinates or file paths.</span>
<span class="sd">                                        (If there&#39;s only one entry, it could be given directly, not in a list)</span>
<span class="sd">                                        The file paths could direct to either a .xyz file, ARC conformers (w/ or w/o</span>
<span class="sd">                                        energies), or an ESS log/input files, making this method extremely flexible.</span>
<span class="sd">                                        Internal coordinates (either string or dict) are also allowed and will be</span>
<span class="sd">                                        converted into cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xyz_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">xyz_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz_list</span><span class="p">]</span>
            <span class="n">xyzs</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">xyz_list</span><span class="p">:</span>
                <span class="n">xyz_</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">xyz_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span> \
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                        <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_directory</span><span class="p">,</span> <span class="n">xyz</span><span class="p">))</span> <span class="k">else</span> <span class="n">xyz</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">InputError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Each xyz entry in xyz_list must be either a string or a dictionary. &#39;</span>
                                     <span class="sa">f</span><span class="s1">&#39;Got:</span><span class="se">\n</span><span class="si">{</span><span class="n">xyz</span><span class="si">}</span><span class="se">\n</span><span class="s1">which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">xyzs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remove_dummies</span><span class="p">(</span><span class="n">check_xyz_dict</span><span class="p">(</span><span class="n">xyz</span><span class="p">)))</span>
                    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># dummy (lists should be the same length)</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">xyz_</span><span class="p">):</span>
                    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">xyz_</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;txt&#39;</span> <span class="ow">in</span> <span class="n">file_extension</span><span class="p">:</span>
                        <span class="c1"># assume this is an ARC conformer file</span>
                        <span class="n">xyzs_</span><span class="p">,</span> <span class="n">energies_</span> <span class="o">=</span> <span class="n">process_conformers_file</span><span class="p">(</span><span class="n">conformers_path</span><span class="o">=</span><span class="n">xyz_</span><span class="p">)</span>
                        <span class="n">xyzs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">remove_dummies</span><span class="p">(</span><span class="n">xyz_</span><span class="p">)</span> <span class="k">for</span> <span class="n">xyz_</span> <span class="ow">in</span> <span class="n">xyzs_</span><span class="p">])</span>
                        <span class="n">energies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">energies_</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># assume this is an ESS log file</span>
                        <span class="n">xyzs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remove_dummies</span><span class="p">(</span><span class="n">parse_xyz_from_file</span><span class="p">(</span><span class="n">xyz_</span><span class="p">)))</span>  <span class="c1"># also calls standardize_xyz_string()</span>
                        <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># dummy (lists should be the same length)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># string which does not represent a (valid) path, treat as a string representation of xyz</span>
                    <span class="n">xyzs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remove_dummies</span><span class="p">(</span><span class="n">str_to_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">)))</span>
                    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># dummy (lists should be the same length)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xyzs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">colliding_atoms</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The following coordinates for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> have colliding atoms:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xyz_to_str</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">check_atom_balance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">check_atom_balance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">xyzs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conformers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">xyzs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conformer_energies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tsg_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xyzs</span><span class="p">,</span> <span class="n">energies</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TSGuess</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;user guess </span><span class="si">{</span><span class="n">tsg_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                   <span class="n">xyz</span><span class="o">=</span><span class="n">remove_dummies</span><span class="p">(</span><span class="n">xyz</span><span class="p">),</span>
                                                   <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span>
                                                   <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                   <span class="p">))</span>
                    <span class="c1"># user guesses are always successful in generating a *guess*:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts_guesses</span><span class="p">[</span><span class="n">tsg_index</span><span class="p">]</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">tsg_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">xyzs</span><span class="p">:</span>
                    <span class="n">consistent</span> <span class="o">=</span> <span class="n">check_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">consistent</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inconsistent combination of number of electrons, multiplicity and charge &#39;</span>
                                           <span class="sa">f</span><span class="s1">&#39;for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.set_transport_data"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.set_transport_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_transport_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">lj_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">opt_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">bath_gas</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">opt_level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span>
                           <span class="n">freq_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">freq_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Level</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the species.transport_data attribute after a Lennard-Jones calculation (via OneDMin).</span>

<span class="sd">        Args:</span>
<span class="sd">            lj_path (str): The path to a oneDMin job output file.</span>
<span class="sd">            opt_path (str): The path to an opt job output file.</span>
<span class="sd">            bath_gas (str): The oneDMin job bath gas.</span>
<span class="sd">            opt_level (Level): The optimization level of theory.</span>
<span class="sd">            freq_path (str, optional): The path to a frequencies job output file.</span>
<span class="sd">            freq_level (Level, optional): The frequencies level of theory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport_data</span><span class="o">.</span><span class="n">comment</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;L-J coefficients calculated by OneDMin using a DF-MP2/aug-cc-pVDZ potential energy surface &#39;</span> \
                  <span class="s1">&#39;with </span><span class="si">{0}</span><span class="s1"> as the bath gas&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bath_gas</span><span class="p">)</span>
        <span class="n">epsilon</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lj_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Epsilons[1/cm]&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># Conversion of cm^-1 to J/mol (see https://cccbdb.nist.gov/wavenumber.asp)</span>
                <span class="n">epsilon</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">11.96266</span><span class="p">,</span> <span class="s1">&#39;J/mol&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;Sigmas[angstrom]&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># Convert Angstroms to meters</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;; The molecule is monoatomic&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_linear</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">()[</span><span class="s1">&#39;coords&#39;</span><span class="p">])):</span>
                <span class="n">shape_index</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;; The molecule is linear&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape_index</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dipole_moment</span> <span class="o">=</span> <span class="n">parse_dipole_moment</span><span class="p">(</span><span class="n">opt_path</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">dipole_moment</span><span class="p">:</span>
                <span class="n">comment</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;; Dipole moment was calculated at the </span><span class="si">{</span><span class="n">opt_level</span><span class="o">.</span><span class="n">simple</span><span class="p">()</span><span class="si">}</span><span class="s1"> level of theory&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dipole_moment</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport_data</span><span class="o">.</span><span class="n">polarizability</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;angstroms^3&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">freq_path</span><span class="p">:</span>
            <span class="n">polar</span> <span class="o">=</span> <span class="p">(</span><span class="n">parse_polarizability</span><span class="p">(</span><span class="n">freq_path</span><span class="p">),</span> <span class="s1">&#39;angstroms^3&#39;</span><span class="p">)</span>
            <span class="n">comment</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;; Polarizability was calculated at the </span><span class="si">{</span><span class="n">freq_level</span><span class="o">.</span><span class="n">simple</span><span class="p">()</span><span class="si">}</span><span class="s1"> level of theory&#39;</span>
        <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;; Rotational Relaxation Collision Number was not determined, default value is 2&#39;</span>
        <span class="k">if</span> <span class="n">original_comment</span><span class="p">:</span>
            <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;; &#39;</span> <span class="o">+</span> <span class="n">original_comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport_data</span> <span class="o">=</span> <span class="n">TransportData</span><span class="p">(</span>
            <span class="n">shapeIndex</span><span class="o">=</span><span class="n">shape_index</span><span class="p">,</span>
            <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span>
            <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
            <span class="n">dipoleMoment</span><span class="o">=</span><span class="p">(</span><span class="n">dipole_moment</span><span class="p">,</span> <span class="s1">&#39;De&#39;</span><span class="p">),</span>
            <span class="n">polarizability</span><span class="o">=</span><span class="n">polar</span><span class="p">,</span>
            <span class="n">rotrelaxcollnum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># rotational relaxation collision number at 298 K</span>
            <span class="n">comment</span><span class="o">=</span><span class="n">comment</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.check_xyz_isomorphism"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.check_xyz_isomorphism">[docs]</a>    <span class="k">def</span> <span class="nf">check_xyz_isomorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">mol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Molecule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">xyz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">allow_nonisomorphic_2d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the perception of self.final_xyz or ``xyz`` is isomorphic with self.mol.</span>
<span class="sd">        If it is not isomorphic, compliant coordinates will be checked (equivalent to checking isomorphism without</span>
<span class="sd">        bond order information, only does not necessitate a molecule object, directly checks bond lengths).</span>

<span class="sd">        Args:</span>
<span class="sd">            mol (Molecule, optional): A molecule to check instead of self.mol.</span>
<span class="sd">            xyz (dict, optional): The coordinates to check instead of self.final_xyz.</span>
<span class="sd">            allow_nonisomorphic_2d (bool, optional): Whether to allow non-isomorphic representations to pass this test.</span>
<span class="sd">            verbose (bool, optional): Whether to log isomorphism findings and errors.</span>

<span class="sd">        Returns: bool</span>
<span class="sd">            Whether the perception of self.final_xyz is isomorphic with self.mol, ``True`` if it is.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span>
        <span class="n">isomorphic</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">s_mol</span><span class="p">,</span> <span class="n">b_mol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="c1"># 1. Perceive</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s_mol</span><span class="p">,</span> <span class="n">b_mol</span> <span class="o">=</span> <span class="n">molecules_from_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not perceive the Cartesian coordinates of species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">. This &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;might result in inconsistent atom order between the Cartesian and the 2D graph &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;representations. Got:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># 2. A. Check isomorphism with bond orders using b_mol</span>
            <span class="k">if</span> <span class="n">b_mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">isomorphic</span> <span class="o">=</span> <span class="n">check_isomorphism</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">b_mol</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isomorphic</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The Cartesian coordinates of species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> are not isomorphic with the 2D &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;structure </span><span class="si">{</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span><span class="si">}</span><span class="s1"> when considering bond orders.&#39;</span><span class="p">)</span>

            <span class="c1"># 2. B. Check isomorphism without bond orders using s_mol (only for charged or high spin multiplicity)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isomorphic</span> <span class="ow">and</span> <span class="n">s_mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">isomorphic</span> <span class="o">=</span> <span class="n">check_isomorphism</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">s_mol</span><span class="p">,</span> <span class="n">convert_to_single_bonds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isomorphic</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The Cartesian coordinates of species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> with charge </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="si">}</span><span class="s1"> &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;and multiplicity </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="si">}</span><span class="s1"> are not isomorphic with the 2D &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;structure </span><span class="si">{</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span><span class="si">}</span><span class="s1"> even without considering bond orders.&#39;</span><span class="p">)</span>

            <span class="c1"># 2. C. Check isomorphism without bond orders NOT using s_mol</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isomorphic</span><span class="p">:</span>
                <span class="n">isomorphic</span> <span class="o">=</span> <span class="n">are_coords_compliant_with_graph</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span> <span class="n">mol</span><span class="o">=</span><span class="n">mol</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isomorphic</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The Cartesian coordinates of species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> are not compliant with the 2D &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;structure </span><span class="si">{</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span><span class="si">}</span><span class="s1"> even without considering bond orders.&#39;</span><span class="p">)</span>

            <span class="c1"># 3. Report and resolve</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isomorphic</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">allow_nonisomorphic_2d</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Allowing nonisomorphic 2D&#39;</span><span class="p">)</span>
                    <span class="n">isomorphic</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_is_isomorphic</span><span class="p">:</span>
                        <span class="c1"># conformer was isomorphic, we don&#39;t allow nonisomorphism, but the optimized structure isn&#39;t</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Not allowing nonisomorphic 2D (the conformer WAS isomorphic with the 2D graph)&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Not allowing nonisomorphic 2D&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot check isomorphism for species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;without the 2D graph connectivity information.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">allow_nonisomorphic_2d</span><span class="p">:</span>
                <span class="n">isomorphic</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Allowing nonisomorphic 2D&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">isomorphic</span></div>

<div class="viewcode-block" id="ARCSpecies.label_atoms"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.label_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">label_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Labels atoms in order.</span>
<span class="sd">        The label is stored in the atom.label property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCSpecies.scissors"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.scissors">[docs]</a>    <span class="k">def</span> <span class="nf">scissors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">sort_atom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cut chemical bonds to create new species from the original one according to the .bdes attribute,</span>
<span class="sd">        preserving the 3D geometry other than the scissioned bond.</span>
<span class="sd">        If one of the scission-resulting species is a hydrogen atom, it will be returned last, labeled as &#39;H&#39;.</span>
<span class="sd">        Other species labels will be &lt;original species label&gt;_BDE_index1_index2_X, where &quot;X&quot; is either &quot;A&quot; or &quot;B&quot;,</span>
<span class="sd">        and the indices are 1-indexed.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            sort_atom_labels (bool, optional): Boolean flag, determines whether sorting is required.</span>

<span class="sd">        Returns: list</span>
<span class="sd">            The scission-resulting species.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_h</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s1">&#39;all_h&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">all_h</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;all_h&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not interpret entry </span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="si">}</span><span class="s1"> for BDEs calculations.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`indices` entries must be tuples or lists, &#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;got </span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">bde</span><span class="p">)</span> <span class="k">for</span> <span class="n">bde</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">all_h</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">atom1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">atom1</span><span class="o">.</span><span class="n">is_hydrogen</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">atom2</span><span class="p">,</span> <span class="n">bond12</span> <span class="ow">in</span> <span class="n">atom1</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">bond12</span><span class="o">.</span><span class="n">is_single</span><span class="p">():</span>
                            <span class="n">atom_indices</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atom2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atom1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">atom_indices_reverse</span> <span class="o">=</span> <span class="p">(</span><span class="n">atom_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atom_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">atom_indices</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span> <span class="ow">and</span> <span class="n">atom_indices_reverse</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sort_atom_labels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_atoms</span><span class="p">()</span>
        <span class="n">resulting_species</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index_tuple</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdes</span><span class="p">:</span>
            <span class="n">new_species_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scissors</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">index_tuple</span><span class="p">,</span> <span class="n">sort_atom_labels</span><span class="o">=</span><span class="n">sort_atom_labels</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">new_species</span> <span class="ow">in</span> <span class="n">new_species_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_species</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">existing_species</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">existing_species</span> <span class="ow">in</span> <span class="n">resulting_species</span><span class="p">]:</span>
                    <span class="c1"># Mainly checks that the H species doesn&#39;t already exist.</span>
                    <span class="n">resulting_species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_species</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resulting_species</span></div>

    <span class="k">def</span> <span class="nf">_scissors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">indices</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
                  <span class="n">sort_atom_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cut a chemical bond to create two new species from the original one, preserving the 3D geometry.</span>

<span class="sd">        Args:</span>
<span class="sd">            indices (tuple): The atom indices between which to cut (1-indexed, atoms must be bonded).</span>
<span class="sd">            sort_atom_labels (bool, optional): Boolean flag, determines whether sorting is required.</span>

<span class="sd">        Returns: list</span>
<span class="sd">            The scission-resulting species, a list of either one or two species, if the scissored location is linear,</span>
<span class="sd">            or one if the scission is in a cycle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scissors indices must be greater than 0 (1-indexed). Got: </span><span class="si">{</span><span class="n">indices</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scissors indices must be integers. Got: </span><span class="si">{</span><span class="n">indices</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot use scissors without the .final_xyz attribute of species </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected two indices, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">convert_list_index_0_to_1</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">direction</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">mol_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># We are about to change the connectivity of the atoms in the molecule,</span>
        <span class="c1"># which invalidates any existing vertex connectivity information; thus we reset it.</span>
        <span class="n">mol_copy</span><span class="o">.</span><span class="n">reset_connectivity_values</span><span class="p">()</span>
        <span class="n">atom1</span> <span class="o">=</span> <span class="n">mol_copy</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">atom2</span> <span class="o">=</span> <span class="n">mol_copy</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mol_copy</span><span class="o">.</span><span class="n">has_bond</span><span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="s1">&#39;Attempted to remove a nonexistent bond.&#39;</span><span class="p">)</span>
        <span class="n">bond</span> <span class="o">=</span> <span class="n">mol_copy</span><span class="o">.</span><span class="n">get_bond</span><span class="p">(</span><span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bond</span><span class="o">.</span><span class="n">is_single</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scissors were requested to remove a non-single bond in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="n">mol_copy</span><span class="o">.</span><span class="n">remove_bond</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="n">mol_splits</span><span class="p">,</span> <span class="n">fragment_indices</span> <span class="o">=</span> <span class="n">split_mol</span><span class="p">(</span><span class="n">mol_copy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sort_atom_labels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">mol_splits</span><span class="p">:</span>
                <span class="n">sort_atoms_in_descending_label_order</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_splits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># If cutting leads to only one split, then the split is cyclic.</span>
            <span class="n">spc1</span> <span class="o">=</span> <span class="n">ARCSpecies</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;_BDE_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_cyclic&#39;</span><span class="p">,</span>
                              <span class="n">mol</span><span class="o">=</span><span class="n">mol_splits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">multiplicity</span><span class="o">=</span><span class="n">mol_splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span>
                              <span class="n">charge</span><span class="o">=</span><span class="n">mol_splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_net_charge</span><span class="p">(),</span>
                              <span class="n">compute_thermo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">e0_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">spc1</span><span class="o">.</span><span class="n">generate_conformers</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">spc1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_splits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span> <span class="o">=</span> <span class="n">mol_splits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not split </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> between indices </span><span class="si">{</span><span class="n">indices</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">used_a_label</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mol1</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_hydrogen</span><span class="p">():</span>
            <span class="n">label1</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;_BDE_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_A&#39;</span>
            <span class="n">used_a_label</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mol2</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_hydrogen</span><span class="p">():</span>
            <span class="n">label2</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">letter</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span> <span class="k">if</span> <span class="n">used_a_label</span> <span class="k">else</span> <span class="s1">&#39;A&#39;</span>
            <span class="n">label2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;_BDE_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">letter</span>

        <span class="n">added_radical</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">mol</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">],</span> <span class="p">[</span><span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="n">theoretical_charge</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">PeriodicSystem</span><span class="o">.</span><span class="n">valence_electrons</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span> \
                                     <span class="o">-</span> <span class="n">atom</span><span class="o">.</span><span class="n">get_total_bond_order</span><span class="p">()</span> \
                                     <span class="o">-</span> <span class="n">atom</span><span class="o">.</span><span class="n">radical_electrons</span> <span class="o">-</span> \
                                     <span class="mi">2</span> <span class="o">*</span> <span class="n">atom</span><span class="o">.</span><span class="n">lone_pairs</span>
                <span class="k">if</span> <span class="n">theoretical_charge</span> <span class="o">==</span> <span class="n">atom</span><span class="o">.</span><span class="n">charge</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># we&#39;re missing a radical electron on this atom</span>
                    <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">added_radical</span> <span class="ow">or</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>
                        <span class="n">atom</span><span class="o">.</span><span class="n">radical_electrons</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">added_radical</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not figure out which atom should gain a radical &#39;</span>
                                           <span class="sa">f</span><span class="s1">&#39;due to scission in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">mol1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">log_species</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mol2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">log_species</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">raise_atomtype_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">xyz1</span><span class="p">,</span> <span class="n">xyz2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">xyz1</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fragment_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">xyz2</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fragment_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">xyz1</span><span class="p">[</span><span class="s1">&#39;isotopes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">isotope</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span><span class="p">[</span><span class="s1">&#39;isotopes&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fragment_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">xyz2</span><span class="p">[</span><span class="s1">&#39;isotopes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">isotope</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span><span class="p">[</span><span class="s1">&#39;isotopes&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fragment_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">xyz1</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coord</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fragment_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">xyz2</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coord</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_xyz</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fragment_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">xyz1</span><span class="p">,</span> <span class="n">xyz2</span> <span class="o">=</span> <span class="n">translate_to_center_of_mass</span><span class="p">(</span><span class="n">xyz1</span><span class="p">),</span> <span class="n">translate_to_center_of_mass</span><span class="p">(</span><span class="n">xyz2</span><span class="p">)</span>

        <span class="n">spc1</span> <span class="o">=</span> <span class="n">ARCSpecies</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span>
                          <span class="n">mol</span><span class="o">=</span><span class="n">mol1</span><span class="p">,</span>
                          <span class="n">xyz</span><span class="o">=</span><span class="n">xyz1</span><span class="p">,</span>
                          <span class="n">multiplicity</span><span class="o">=</span><span class="n">mol1</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span>
                          <span class="n">charge</span><span class="o">=</span><span class="n">mol1</span><span class="o">.</span><span class="n">get_net_charge</span><span class="p">(),</span>
                          <span class="n">compute_thermo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">e0_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">keep_mol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">spc1</span><span class="o">.</span><span class="n">generate_conformers</span><span class="p">()</span>
        <span class="n">spc1</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">spc2</span> <span class="o">=</span> <span class="n">ARCSpecies</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span>
                          <span class="n">mol</span><span class="o">=</span><span class="n">mol2</span><span class="p">,</span>
                          <span class="n">xyz</span><span class="o">=</span><span class="n">xyz2</span><span class="p">,</span>
                          <span class="n">multiplicity</span><span class="o">=</span><span class="n">mol2</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span>
                          <span class="n">charge</span><span class="o">=</span><span class="n">mol2</span><span class="o">.</span><span class="n">get_net_charge</span><span class="p">(),</span>
                          <span class="n">compute_thermo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">e0_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">keep_mol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">spc2</span><span class="o">.</span><span class="n">generate_conformers</span><span class="p">()</span>
        <span class="n">spc2</span><span class="o">.</span><span class="n">rotors_dict</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">spc1</span><span class="p">,</span> <span class="n">spc2</span><span class="p">]</span>

<div class="viewcode-block" id="ARCSpecies.populate_ts_checks"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.ARCSpecies.populate_ts_checks">[docs]</a>    <span class="k">def</span> <span class="nf">populate_ts_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Populate (or restart) the .ts_checks attribute with default (``None``) values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ts</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E0&#39;</span><span class="p">,</span> <span class="s1">&#39;e_elect&#39;</span><span class="p">,</span> <span class="s1">&#39;IRC&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="s1">&#39;NMD&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_checks</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts_checks</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></div></div>


<div class="viewcode-block" id="TSGuess"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess">[docs]</a><span class="k">class</span> <span class="nc">TSGuess</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for representing TS a guess.</span>

<span class="sd">    Args:</span>
<span class="sd">        index (int, optional): A running index of all TSGuess objects belonging to an ARCSpecies object.</span>
<span class="sd">        method (str, optional): The method/source used for the xyz guess.</span>
<span class="sd">        method_index (int, optional): A sub-index, used for cases where a single method generates several guesses.</span>
<span class="sd">                                      Counts separately for each direction, &#39;F&#39; and &#39;R&#39;.</span>
<span class="sd">        method_direction (str, optional): The reaction direction used for generating the guess (&#39;F&#39; or &#39;R&#39;).</span>
<span class="sd">        constraints (dict, optional): Any constraints to be used when first optimizing this guess</span>
<span class="sd">                                      (i.e., keeping bond lengths of the reactive site constant).</span>
<span class="sd">        family (str, optional): The RMG family that corresponds to the reaction, if applicable.</span>
<span class="sd">        success (bool, optional): Whether the TS guess method succeeded in generating an XYZ guess or not.</span>
<span class="sd">        xyz (dict, str, optional): The 3D coordinates guess.</span>
<span class="sd">        rmg_reaction (Reaction, optional): An RMG Reaction object.</span>
<span class="sd">        arc_reaction (ARCReaction, optional): An ARC Reaction object.</span>
<span class="sd">        ts_dict (dict, optional): A dictionary to create this object from (used when restarting ARC).</span>
<span class="sd">        energy (float, optional): Relative energy of all TS conformers in kJ/mol.</span>
<span class="sd">        t0 (datetime.datetime, optional): Initial time of spawning the guess job.</span>
<span class="sd">        execution_time (datetime.timedelta, optional): Overall execution time for the TS guess method.</span>
<span class="sd">        project_directory (str, optional): The path to the project directory.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        initial_xyz (dict): The 3D coordinates guess.</span>
<span class="sd">        opt_xyz (dict): The 3D coordinates after optimization at the ts_guesses level.</span>
<span class="sd">        method (str): The method/source used for the xyz guess.</span>
<span class="sd">        method_index (int): A sub-index, used for cases where a single method generates several guesses.</span>
<span class="sd">                            Counts separately for each direction, &#39;F&#39; and &#39;R&#39;.</span>
<span class="sd">        method_direction (str): The reaction direction used for generating the guess (&#39;F&#39; or &#39;R&#39;).</span>
<span class="sd">        family (str): The RMG family that corresponds to the reaction, if applicable.</span>
<span class="sd">        rmg_reaction (Reaction): An RMG Reaction object.</span>
<span class="sd">        arc_reaction (ARCReaction): An ARC Reaction object.</span>
<span class="sd">        t0 (datetime.datetime, optional): Initial time of spawning the guess job.</span>
<span class="sd">        execution_time (str): Overall execution time for the TS guess method.</span>
<span class="sd">        success (bool): Whether the TS guess method succeeded in generating an XYZ guess or not.</span>
<span class="sd">        energy (float): Relative energy of all TS conformers in kJ/mol.</span>
<span class="sd">        index (int): A running index of all TSGuess objects belonging to an ARCSpecies object.</span>
<span class="sd">        imaginary_freqs (List[float]): The imaginary frequencies of the TS guess after optimization.</span>
<span class="sd">        conformer_index (int): An index corresponding to the conformer jobs spawned for each TSGuess object.</span>
<span class="sd">                               Assigned only if self.success is ``True``.</span>
<span class="sd">        successful_irc (bool): Whether the IRS run(s) identified this to be the correct TS by isomorphism of the wells.</span>
<span class="sd">        successful_normal_mode (bool): Whether a normal mode check was successful.</span>
<span class="sd">        errors (str): Problems experienced with this TSGuess. Used for logging.</span>
<span class="sd">        cluster (List[int]): Indices of TSGuess object instances clustered together.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">method_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">method_direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">constraints</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">t0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">execution_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">success</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">family</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">xyz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rmg_reaction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Reaction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">arc_reaction</span><span class="p">:</span> <span class="n">Optional</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">ts_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">cluster</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">project_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="p">):</span>

        <span class="k">if</span> <span class="n">ts_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Reading from a dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ts_dict</span><span class="o">=</span><span class="n">ts_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Not reading from a dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;user guess&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_index</span> <span class="o">=</span> <span class="n">method_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_direction</span> <span class="o">=</span> <span class="n">method_direction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">constraints</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">t0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">execution_time</span> <span class="k">if</span> <span class="n">execution_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">execution_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_opt_xyz</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initial_xyz</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="n">project_directory</span><span class="p">)</span>  <span class="c1"># populates self.initial_xyz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="n">success</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span>
            <span class="k">if</span> <span class="s1">&#39;user guess&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TSError</span><span class="p">(</span><span class="s1">&#39;If no method is specified, an xyz guess must be given&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rmg_reaction</span> <span class="o">=</span> <span class="n">rmg_reaction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arc_reaction</span> <span class="o">=</span> <span class="n">arc_reaction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">family</span> <span class="o">=</span> <span class="n">family</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conformer_index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">successful_irc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">successful_normal_mode</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string representation of the object&quot;&quot;&quot;</span>
        <span class="n">str_representation</span> <span class="o">=</span> <span class="s1">&#39;TSGuess(&#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;index=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">, &#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;method=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;method_index=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method_index</span><span class="si">}</span><span class="s1">, &#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;method_direction=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method_direction</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;cluster=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
        <span class="n">str_representation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;success=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">return</span> <span class="n">str_representation</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">initial_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The initial coordinate guess&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_xyz</span>

    <span class="nd">@initial_xyz</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">initial_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow setting the initial coordinate guess&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_xyz</span> <span class="o">=</span> <span class="n">check_xyz_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">opt_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The optimized coordinates&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opt_xyz</span>

    <span class="nd">@opt_xyz</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">opt_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow setting the initial coordinate guess&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_opt_xyz</span> <span class="o">=</span> <span class="n">check_xyz_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="TSGuess.as_dict"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function for dumping this object as a dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            for_report (bool, optional): Whether to generate a concise dictionary representation</span>
<span class="sd">                                         for the final_ts_guess_report.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The dictionary representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ts_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;method_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_index</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;method_direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_direction</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">)</span> \
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;imaginary_freqs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;conformer_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conformer_index</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;successful_irc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successful_irc</span>
        <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;successful_normal_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successful_normal_mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">or</span> <span class="n">for_report</span><span class="p">:</span>
            <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;initial_xyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_xyz</span> <span class="ow">or</span> <span class="n">for_report</span><span class="p">:</span>
            <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;opt_xyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_xyz</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">for_report</span><span class="p">:</span>
            <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_reaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rxn_string</span> <span class="o">=</span> <span class="s1">&#39; &lt;=&gt; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">spc</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span>
                                                       <span class="k">for</span> <span class="n">spc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_reaction</span><span class="o">.</span><span class="n">reactants</span><span class="p">]),</span>
                                           <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">spc</span><span class="o">.</span><span class="n">molecule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_smiles</span><span class="p">()</span>
                                                       <span class="k">for</span> <span class="n">spc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmg_reaction</span><span class="o">.</span><span class="n">products</span><span class="p">])])</span>
                <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;rmg_reaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxn_string</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
                <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span>
        <span class="k">return</span> <span class="n">ts_dict</span></div>

<div class="viewcode-block" id="TSGuess.from_dict"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper function for loading this object from a dictionary in a YAML file for restarting ARC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;t0&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> \
            <span class="k">else</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;t0&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;initial_xyz&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;initial_xyz&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_xyz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span><span class="p">)</span>  <span class="c1"># re-populates self.initial_xyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_xyz</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;opt_xyz&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;opt_xyz&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;success&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;energy&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;cluster&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">timedelta_from_str</span><span class="p">(</span><span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;execution_time&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> \
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> \
            <span class="k">else</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;execution_time&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;method&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="s1">&#39;user guess&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_index</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;method_index&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;method_index&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_direction</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;method_direction&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;method_index&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;imaginary_freqs&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;imaginary_freqs&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conformer_index</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;conformer_index&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;conformer_index&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successful_irc</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;successful_irc&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;successful_irc&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successful_normal_mode</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;successful_normal_mode&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;successful_normal_mode&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;user guess&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TSError</span><span class="p">(</span><span class="s1">&#39;If no method is specified, an xyz guess must be given (initial_xyz).&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">family</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;family&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;family&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;errors&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmg_reaction</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;rmg_reaction&#39;</span> <span class="ow">in</span> <span class="n">ts_dict</span><span class="p">:</span>
            <span class="n">rxn_string</span> <span class="o">=</span> <span class="n">ts_dict</span><span class="p">[</span><span class="s1">&#39;rmg_reaction&#39;</span><span class="p">]</span>
            <span class="n">plus</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span>
            <span class="n">arrow</span> <span class="o">=</span> <span class="s1">&#39; &lt;=&gt; &#39;</span>
            <span class="k">if</span> <span class="n">arrow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxn_string</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TSError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not read the reaction string. Expected to find &quot; &lt;=&gt; &quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;Got: </span><span class="si">{</span><span class="n">rxn_string</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sides</span> <span class="o">=</span> <span class="n">rxn_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>
            <span class="n">reac</span> <span class="o">=</span> <span class="n">sides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="n">sides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">plus</span> <span class="ow">in</span> <span class="n">reac</span><span class="p">:</span>
                <span class="n">reac</span> <span class="o">=</span> <span class="n">reac</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">plus</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reac</span> <span class="o">=</span> <span class="p">[</span><span class="n">reac</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">plus</span> <span class="ow">in</span> <span class="n">prod</span><span class="p">:</span>
                <span class="n">prod</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">plus</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prod</span> <span class="o">=</span> <span class="p">[</span><span class="n">prod</span><span class="p">]</span>
            <span class="n">reactants</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">reactant</span> <span class="ow">in</span> <span class="n">reac</span><span class="p">:</span>
                    <span class="n">reactants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="n">reactant</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">prod</span><span class="p">:</span>
                    <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Species</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="n">product</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rmg_reaction</span> <span class="o">=</span> <span class="n">Reaction</span><span class="p">(</span><span class="n">reactants</span><span class="o">=</span><span class="n">reactants</span><span class="p">,</span> <span class="n">products</span><span class="o">=</span><span class="n">products</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AtomTypeError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="TSGuess.process_xyz"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess.process_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">process_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">xyz</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                    <span class="n">project_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process the user&#39;s input. If ``xyz`` represents a file path, parse it.</span>

<span class="sd">        Args:</span>
<span class="sd">            xyz (dict, str): The coordinates in a dict/string form or a path to a file containing the coordinates.</span>
<span class="sd">            project_directory (str, optional): The path to the project directory.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InputError: If xyz is of the wrong type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">InputError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;xyz must be either a dictionary or string, got:</span><span class="se">\n</span><span class="si">{</span><span class="n">xyz</span><span class="si">}</span><span class="se">\n</span><span class="s1">which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span> <span class="o">=</span> <span class="n">check_xyz_dict</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">project_directory</span><span class="o">=</span><span class="n">project_directory</span><span class="p">)</span></div>

<div class="viewcode-block" id="TSGuess.get_xyz"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess.get_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">get_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">return_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the highest quality xyz the TSGuess has.</span>
<span class="sd">        Returns ``None`` if no xyz can be retrieved.</span>

<span class="sd">        Args:</span>
<span class="sd">            return_format (str, optional): Whether to output a &#39;dict&#39; or a &#39;str&#39; representation of the respective xyz.</span>

<span class="sd">        Return:</span>
<span class="sd">             Optional[Union[dict, str]]: The xyz coordinates in the requested representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_xyz</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_xyz</span>
        <span class="k">if</span> <span class="n">return_format</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz_to_str</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyz</span></div>

<div class="viewcode-block" id="TSGuess.almost_equal_tsgs"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess.almost_equal_tsgs">[docs]</a>    <span class="k">def</span> <span class="nf">almost_equal_tsgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;TSGuess&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine whether two TSGuess object instances represent the same geometry.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (TSGuess): The other TSGuess object instance to compare to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the two TSGuess object instances represent the same geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">success</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                 <span class="ow">and</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">imaginary_freqs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">imaginary_freqs</span><span class="p">)</span>
                      <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">imaginary_freqs</span><span class="p">)</span>
                      <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">freq_1</span><span class="p">,</span> <span class="n">freq_2</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">freq_1</span><span class="p">,</span> <span class="n">freq_2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imaginary_freqs</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">imaginary_freqs</span><span class="p">)]))):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">almost_equal_coords</span><span class="p">(</span><span class="n">xyz1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(),</span> <span class="n">xyz2</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">())</span> \
                <span class="ow">or</span> <span class="n">compare_confs</span><span class="p">(</span><span class="n">xyz1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(),</span> <span class="n">xyz2</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(),</span> <span class="n">rmsd_score</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TSGuess.tic"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess.tic">[docs]</a>    <span class="k">def</span> <span class="nf">tic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize self.t0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span></div>

<div class="viewcode-block" id="TSGuess.tok"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.TSGuess.tok">[docs]</a>    <span class="k">def</span> <span class="nf">tok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign the time difference between now and self.t0 into self.execution_time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span></div></div>


<div class="viewcode-block" id="determine_occ"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.determine_occ">[docs]</a><span class="k">def</span> <span class="nf">determine_occ</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">charge</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the number of occupied orbitals for an MRCI calculation.</span>

<span class="sd">    Todo</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">electrons</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">xyz</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">electrons</span> <span class="o">+=</span> <span class="n">atom</span><span class="o">.</span><span class="n">number</span>
    <span class="n">electrons</span> <span class="o">-=</span> <span class="n">charge</span></div>


<div class="viewcode-block" id="determine_rotor_symmetry"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.determine_rotor_symmetry">[docs]</a><span class="k">def</span> <span class="nf">determine_rotor_symmetry</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="n">pivots</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
                             <span class="n">rotor_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                             <span class="n">energies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">return_num_wells</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                             <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                             <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the rotor symmetry number from a potential energy scan.</span>
<span class="sd">    The *worst* resolution for each peak and valley is determined.</span>
<span class="sd">    The first criterion for a symmetric rotor is that the highest peak and the lowest peak must be within the</span>
<span class="sd">    worst peak resolution (and the same is checked for valleys).</span>
<span class="sd">    A second criterion for a symmetric rotor is that the highest and lowest peaks must be within 10% of</span>
<span class="sd">    the highest peak value. This is only applied if the highest peak is above 2 kJ/mol.</span>

<span class="sd">    Args:</span>
<span class="sd">        label (str): The species label (used for error messages).</span>
<span class="sd">        pivots (list): A list of two atom indices representing the pivots.</span>
<span class="sd">        rotor_path (str): The path to an ESS output rotor scan file.</span>
<span class="sd">        energies (list, optional): The list of energies in the scan in kJ/mol.</span>
<span class="sd">        return_num_wells (bool, optional): Whether to also return the number of wells, ``True`` to return,</span>
<span class="sd">                                           default is ``False``.</span>
<span class="sd">        log (bool, optional): Whether to log info, error, and warning messages.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InputError: If both or none of the rotor_path and energy arguments are given,</span>
<span class="sd">        or if rotor_path does not point to an existing file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[int, float, int]:</span>
<span class="sd">            int: The symmetry number</span>
<span class="sd">            float: The highest torsional energy barrier in kJ/mol.</span>
<span class="sd">            int (optional): The number of peaks, only returned if ``return_len_peaks`` is ``True``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rotor_path</span> <span class="ow">and</span> <span class="n">energies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Expected either rotor_path or energies, got neither&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rotor_path</span> <span class="ow">and</span> <span class="n">energies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Expected either rotor_path or energies, got both&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">energies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rotor_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InputError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not find the path to the rotor file for species </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">rotor_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="n">parse_1d_scan_energies</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">rotor_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">symmetry</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">max_e</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_e</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">max_e</span>  <span class="c1"># tolerance for the second criterion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">max_e</span>
    <span class="n">min_e</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">energies</span><span class="p">):</span>
        <span class="c1"># Sometimes the opt level and scan levels mismatch, causing the minimum to be close to 0 degrees, but not at 0.</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="n">min_e</span><span class="p">:</span>
            <span class="n">min_e</span> <span class="o">=</span> <span class="n">e</span>
    <span class="n">peaks</span><span class="p">,</span> <span class="n">valleys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>  <span class="c1"># the peaks and valleys of the scan</span>
    <span class="n">worst_peak_resolution</span><span class="p">,</span> <span class="n">worst_valley_resolution</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">energies</span><span class="p">):</span>
        <span class="c1"># Identify peaks and valleys, and determine the worst resolutions in the scan.</span>
        <span class="n">ip1</span> <span class="o">=</span> <span class="n">cyclic_index_i_plus_1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span>  <span class="c1"># i Plus 1</span>
        <span class="n">im1</span> <span class="o">=</span> <span class="n">cyclic_index_i_minus_1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># i Minus 1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span> <span class="o">==</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># If the first and last scan points have same energy, change im1</span>
            <span class="n">im1</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;im1: </span><span class="si">{</span><span class="n">im1</span><span class="si">}</span><span class="s1">, ip1: </span><span class="si">{</span><span class="n">ip1</span><span class="si">}</span><span class="s1">, em1: </span><span class="si">{</span><span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span><span class="si">}</span><span class="s1">, e: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">, ep1: </span><span class="si">{</span><span class="n">energies</span><span class="p">[</span><span class="n">ip1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="n">energies</span><span class="p">[</span><span class="n">ip1</span><span class="p">]:</span>
            <span class="c1"># this is a local peak</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">worst_peak_resolution</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span> <span class="o">-</span> <span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">],</span> <span class="n">e</span> <span class="o">-</span> <span class="n">energies</span><span class="p">[</span><span class="n">ip1</span><span class="p">]]]):</span>
                <span class="n">worst_peak_resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">],</span> <span class="n">e</span> <span class="o">-</span> <span class="n">energies</span><span class="p">[</span><span class="n">ip1</span><span class="p">])</span>
            <span class="n">peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="n">energies</span><span class="p">[</span><span class="n">ip1</span><span class="p">]:</span>
            <span class="c1"># this is a local valley</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">worst_valley_resolution</span> <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="p">[</span><span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">,</span> <span class="n">energies</span><span class="p">[</span><span class="n">ip1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">]]):</span>
                <span class="n">worst_valley_resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="n">im1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">,</span> <span class="n">energies</span><span class="p">[</span><span class="n">ip1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span>
            <span class="n">valleys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1"># The number of peaks and valley must always be the same (what goes up must come down), if it isn&#39;t then there&#39;s</span>
    <span class="c1"># something seriously wrong with the scan</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valleys</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rotor of species </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> in pivots </span><span class="si">{</span><span class="n">pivots</span><span class="si">}</span><span class="s1"> does not have the same number &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;of peaks (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="si">}</span><span class="s1">) and valleys (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valleys</span><span class="p">)</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_num_wells</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">),</span> <span class="n">max_e</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>  <span class="c1"># this works for CC(=O)[O]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">),</span> <span class="n">max_e</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># this works for CC(=O)[O]</span>
    <span class="n">min_peak</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">max_peak</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">min_valley</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valleys</span><span class="p">)</span>
    <span class="n">max_valley</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">valleys</span><span class="p">)</span>
    <span class="c1"># Criterion 1: worst resolution</span>
    <span class="k">if</span> <span class="n">max_peak</span> <span class="o">-</span> <span class="n">min_peak</span> <span class="o">&gt;</span> <span class="n">worst_peak_resolution</span><span class="p">:</span>
        <span class="c1"># The rotor cannot be symmetric</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;worst peak resolution criterion&#39;</span>
    <span class="k">elif</span> <span class="n">max_valley</span> <span class="o">-</span> <span class="n">min_valley</span> <span class="o">&gt;</span> <span class="n">worst_valley_resolution</span><span class="p">:</span>
        <span class="c1"># The rotor cannot be symmetric</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;worst valley resolution criterion&#39;</span>
    <span class="c1"># Criterion 2: 10% * max_peak</span>
    <span class="k">elif</span> <span class="n">max_peak</span> <span class="o">-</span> <span class="n">min_peak</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
        <span class="c1"># The rotor cannot be symmetric</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;10</span><span class="si">% o</span><span class="s1">f the maximum peak criterion&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># We declare this rotor as symmetric and the symmetry number is the number of peaks (and valleys)</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;number of peaks and valleys, all within the determined resolution criteria&#39;</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">symmetry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Determined symmetry number </span><span class="si">{</span><span class="n">symmetry</span><span class="si">}</span><span class="s1"> for rotor of species </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> in pivots </span><span class="si">{</span><span class="n">pivots</span><span class="si">}</span><span class="s1">; &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;you should make sure this makes sense.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Determined a symmetry number of </span><span class="si">{</span><span class="n">symmetry</span><span class="si">}</span><span class="s1"> for rotor of species </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> in pivots &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pivots</span><span class="si">}</span><span class="s1"> based on the </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_num_wells</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">symmetry</span><span class="p">,</span> <span class="n">max_e</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">symmetry</span><span class="p">,</span> <span class="n">max_e</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="cyclic_index_i_plus_1"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.cyclic_index_i_plus_1">[docs]</a><span class="k">def</span> <span class="nf">cyclic_index_i_plus_1</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A helper function for cyclic indexing rotor scans&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">length</span> <span class="k">else</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="cyclic_index_i_minus_1"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.cyclic_index_i_minus_1">[docs]</a><span class="k">def</span> <span class="nf">cyclic_index_i_minus_1</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A helper function for cyclic indexing rotor scans&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span></div>


<div class="viewcode-block" id="determine_rotor_type"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.determine_rotor_type">[docs]</a><span class="k">def</span> <span class="nf">determine_rotor_type</span><span class="p">(</span><span class="n">rotor_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine whether this rotor should be treated as a HinderedRotor of a FreeRotor</span>
<span class="sd">    according to its maximum peak.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">parse_1d_scan_energies</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">rotor_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;FreeRotor&#39;</span> <span class="k">if</span> <span class="n">max_val</span> <span class="o">&lt;</span> <span class="n">minimum_barrier</span> <span class="k">else</span> <span class="s1">&#39;HinderedRotor&#39;</span></div>


<div class="viewcode-block" id="enumerate_bonds"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.enumerate_bonds">[docs]</a><span class="k">def</span> <span class="nf">enumerate_bonds</span><span class="p">(</span><span class="n">mol</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function for calling Molecule.enumerate_bonds.</span>
<span class="sd">    First, get the Kekulized molecule (get the Kekule version with alternating single and double bonds if the molecule</span>
<span class="sd">    is aromatic), since we don&#39;t have implementation for aromatic bond additivity corrections.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol (Molecule): The 2D graph representation of the molecule.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Keys are bond types (elements and bond order symbol), values are number of occurrences per bond type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mol_list</span> <span class="o">=</span> <span class="n">generate_kekule_structure</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mol_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mol_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">enumerate_bonds</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mol</span><span class="o">.</span><span class="n">enumerate_bonds</span><span class="p">()</span></div>


<div class="viewcode-block" id="check_xyz"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.check_xyz">[docs]</a><span class="k">def</span> <span class="nf">check_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
              <span class="n">multiplicity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
              <span class="n">charge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
              <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks xyz for electronic consistency with the spin multiplicity and charge.</span>

<span class="sd">    Args:</span>
<span class="sd">        xyz (dict): The species coordinates.</span>
<span class="sd">        multiplicity (int): The species spin multiplicity.</span>
<span class="sd">        charge (int): The species net charge.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Whether the input arguments are all in agreement. True if they are.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]</span>
    <span class="n">electrons</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">element_symbol</span> <span class="ow">in</span> <span class="n">symbol_by_number</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="n">element_symbol</span><span class="p">:</span>
                <span class="n">electrons</span> <span class="o">+=</span> <span class="n">number</span>
                <span class="k">break</span>
    <span class="n">electrons</span> <span class="o">-=</span> <span class="n">charge</span>
    <span class="k">if</span> <span class="n">electrons</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">^</span> <span class="n">multiplicity</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="are_coords_compliant_with_graph"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.are_coords_compliant_with_graph">[docs]</a><span class="k">def</span> <span class="nf">are_coords_compliant_with_graph</span><span class="p">(</span><span class="n">xyz</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                    <span class="n">mol</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">,</span>
                                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the Cartesian coordinates represent the same 2D connectivity as the graph.</span>
<span class="sd">    Bond orders are not considered here, this function checks whether the coordinates represent a bond length</span>
<span class="sd">    below 120% of the single bond length of the respective elements.</span>

<span class="sd">    Args:</span>
<span class="sd">        xyz (dict): The Cartesian coordinates.</span>
<span class="sd">        mol (Molecule): The 2D graph connectivity information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Whether the coordinates are compliant with the 2D connectivity graph. ``True`` if they are.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checked_atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">atom_index_1</span><span class="p">,</span> <span class="n">atom1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">atom1</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="o">!=</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">][</span><span class="n">atom_index_1</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Element order in xyz (</span><span class="si">{</span><span class="n">xyz</span><span class="p">[</span><span class="s2">&quot;symbols&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">) differs from mol &#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">atom2</span> <span class="ow">in</span> <span class="n">atom1</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">atom_index_2</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atom2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">atom_index_2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">checked_atoms</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">],</span> <span class="n">atoms</span><span class="o">=</span><span class="p">[</span><span class="n">atom_index_1</span><span class="p">,</span> <span class="n">atom_index_2</span><span class="p">])</span>
                <span class="n">single_bond_r</span> <span class="o">=</span> <span class="n">get_single_bond_length</span><span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">atom2</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">single_bond_r</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="n">checked_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_index_1</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="colliding_atoms"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.colliding_atoms">[docs]</a><span class="k">def</span> <span class="nf">colliding_atoms</span><span class="p">(</span><span class="n">xyz</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                    <span class="n">mol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Molecule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether atoms are too close to each other.</span>
<span class="sd">        A default threshold of 55% the covalent radii of two atoms is used.</span>
<span class="sd">        For example:</span>
<span class="sd">        - C-O collide at 55% * 1.42 A = 0.781 A</span>
<span class="sd">        - N-N collide at 55% * 1.42 A = 0.781 A</span>
<span class="sd">        - C-N collide at 55% * 1.47 A = 0.808 A</span>
<span class="sd">        - C-H collide at 55% * 1.07 A = 0.588 A</span>
<span class="sd">        - H-H collide at 55% * 0.74 A = 0.588 A</span>

<span class="sd">        Args:</span>
<span class="sd">            xyz (dict): The Cartesian coordinates.</span>
<span class="sd">            mol (Molecule, optional): The corresponding Molecule object instance with formal charge information.</span>
<span class="sd">            threshold (float, optional): The collision threshold to use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: ``True`` if they are colliding, ``False`` otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># monoatomic</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])):</span>
            <span class="n">actual_r</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">],</span> <span class="n">atoms</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">charge_1</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span> <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">charge_2</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span> <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">single_bond_r</span> <span class="o">=</span> <span class="n">get_single_bond_length</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">charge_1</span><span class="p">,</span> <span class="n">charge_2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">actual_r</span> <span class="o">&lt;</span> <span class="n">single_bond_r</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="check_label"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.check_label">[docs]</a><span class="k">def</span> <span class="nf">check_label</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">is_ts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether a species (or reaction) label is legal, modify it if needed.</span>

<span class="sd">    Args:</span>
<span class="sd">        label (str): A label.</span>
<span class="sd">        is_ts (bool, optional): Whether the species label belongs to a transition state.</span>
<span class="sd">        verbose (bool, optional): Whether to log errors.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If the label is not a string type.</span>
<span class="sd">        SpeciesError: If label is illegal and cannot be automatically fixed.</span>

<span class="sd">    Returns: Tuple[str, Optional[str]]</span>
<span class="sd">        - A legal label.</span>
<span class="sd">        - The original label if the label was modified, else ``None``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A species label must be a string type, got </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> which is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">label</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_ts</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A non-TS species cannot be named &quot;TS&quot; with a subsequent index, got </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">char_replacement</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;#&#39;</span><span class="p">:</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;=&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;(&#39;</span><span class="p">:</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;)&#39;</span><span class="p">:</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span>
                        <span class="s1">&#39; &#39;</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;$&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;@&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;+&#39;</span><span class="p">:</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
    <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">original_label</span> <span class="o">=</span> <span class="n">label</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">original_label</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_chars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Label </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> contains an invalid character: &quot;</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_replacement</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">char_replacement</span><span class="p">[</span><span class="n">char</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">modified</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Replaced species label.</span><span class="se">\n</span><span class="s1">&#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;Original label was: &quot;</span><span class="si">{</span><span class="n">original_label</span><span class="si">}</span><span class="s1">&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;New label is: &quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">original_label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">label</span><span class="p">,</span> <span class="n">original_label</span></div>


<div class="viewcode-block" id="check_atom_balance"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.check_atom_balance">[docs]</a><span class="k">def</span> <span class="nf">check_atom_balance</span><span class="p">(</span><span class="n">entry_1</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
                       <span class="n">entry_2</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
                       <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the two entries are in atom balance.</span>

<span class="sd">    Args:</span>
<span class="sd">        entry_1 (Union[dict, str, Molecule]): Either an xyz (dict or str) or an RMG Molecule object.</span>
<span class="sd">        entry_2 (Union[dict, str, Molecule]): Either an xyz (dict or str) or an RMG Molecule object.</span>
<span class="sd">        verbose (Optional[bool]): Whether to log the differences if found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        SpeciesError: If both entries are empty.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Whether ``entry1`` and ``entry2`` are in atomic balance. ``True`` id they are.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry_1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entry_2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SpeciesError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot compare entries. Got:</span><span class="se">\n</span><span class="si">{</span><span class="n">entry_1</span><span class="si">}</span><span class="se">\n</span><span class="s1">and</span><span class="se">\n</span><span class="si">{</span><span class="n">entry_2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">element_dict_1</span><span class="p">,</span> <span class="n">element_dict_2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Count the number of each element.</span>
    <span class="k">for</span> <span class="n">element_dict</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">element_dict_1</span><span class="p">,</span> <span class="n">element_dict_2</span><span class="p">],</span> <span class="p">[</span><span class="n">entry_1</span><span class="p">,</span> <span class="n">entry_2</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span>
                <span class="n">element_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">element_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">check_xyz_dict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]:</span>
                <span class="n">element_dict</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">element_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Compare elements.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">element_dict_1</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">element_dict_1</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">element_dict_1</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">element_dict_2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
            <span class="n">num_1</span><span class="p">,</span> <span class="n">num_2</span> <span class="o">=</span> <span class="n">element_dict_1</span><span class="p">[</span><span class="n">symbol</span><span class="p">],</span> <span class="n">element_dict_2</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">num_1</span> <span class="o">!=</span> <span class="n">num_2</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Entries have different types or numbers of elements, got:</span><span class="se">\n</span><span class="s1">&#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">element_dict_1</span><span class="si">}</span><span class="se">\n</span><span class="s1">and</span><span class="se">\n</span><span class="si">{</span><span class="n">element_dict_2</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="split_mol"><a class="viewcode-back" href="../../../api/species.html#arc.species.species.split_mol">[docs]</a><span class="k">def</span> <span class="nf">split_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Molecule</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split an RMG Molecule object by connectivity gaps while retaining the relative atom order.</span>

<span class="sd">    Args:</span>
<span class="sd">        mol (Molecule): The Molecule to split.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[Molecule], List[List[int]]]:</span>
<span class="sd">            - Entries are molecular fragments resulting from the split.</span>
<span class="sd">            - Entries are lists with indices that correspond to the original atoms that were assigned to each fragment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fragments</span><span class="p">,</span> <span class="n">molecules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">unvisited_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)))</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">unvisited_indices</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">unvisited_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">frag_indices</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">mol</span><span class="o">=</span><span class="n">mol</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">sort_result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">unvisited_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">unvisited_indices</span> <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frag_indices</span><span class="p">]</span>
        <span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Molecule</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">frag_indices</span><span class="p">]))</span>
        <span class="n">fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag_indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">molecules</span><span class="p">,</span> <span class="n">fragments</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2024, Alon Grinberg Dana

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>